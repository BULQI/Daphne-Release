<docking:ToolWindow x:Class="DaphneGui.SimConfigToolWindow"
                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:sys="clr-namespace:System;assembly=mscorlib"
                    xmlns:local="clr-namespace:DaphneGui"
                    xmlns:shared="http://schemas.actiprosoftware.com/winfx/xaml/shared"
                    xmlns:editors="http://schemas.actiprosoftware.com/winfx/xaml/editors"
                    xmlns:docking="http://schemas.actiprosoftware.com/winfx/xaml/docking"
                    ImageSource="Images/Properties16.png"
                    >

    <TabControl x:Name="ConfigTabControl" Grid.Column="0" TabStripPlacement="Bottom">
        <TabControl.Resources>
            <!-- For changing color of alternating rows of ListBox -->
            <Style  TargetType="{x:Type ListBoxItem}">
                <Style.Triggers>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                        <Setter Property="Background" Value="White"></Setter>
                    </Trigger>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                        <Setter Property="Background" Value="Beige"></Setter>
                        <Setter Property="BorderBrush" Value="Black" />
                        <Setter Property="BorderThickness" Value="1" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <local:GlobalParamTypeToStringConverter x:Key="GlobalParameterTypeEnumConv" />
            <local:SolfacDistributionTypeToStringConverter x:Key="SolfacDistTypeEnumConv" />
            <!--<local:SolfacGUIDtoReceptorNameConverter x:Key="SolfacGUIDtoReceptorNameConv" />-->
            <local:SWMColorToSolidBrushConverter x:Key="colorToSolidBrushConv" />
            <!--<local:CellTypeGUIDtoNameConverter x:Key="CellTypeGUIDtoNameConv" />-->
            <!--<local:SolfacGUIDtoSolfacNameConverter x:Key="SolfacGUIDtoSolfacNameConv" />-->
            <local:RegionGUIDtoNameConverter x:Key="RegionGUIDtoNameConv" />
            <local:RelativePositionToShortStringConverter x:Key="RelativePosEnumConv" />
            <local:ManyToBooleanConverter x:Key="ManyConv" />

            <ObjectDataProvider x:Key="regionShapesEnum"
                            MethodName="GetValues" 
                            ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="local:RegionShape" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="relativePosition"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="local:RelativePosition" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="molpopDistributionTypes"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="local:MolPopDistributionType" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            
            <ObjectDataProvider x:Key="bPhenotypesEnum"
                            MethodName="GetValues" 
                            ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="local:BCellPhenotype" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            <ObjectDataProvider x:Key="tPhenotypesEnum"
                            MethodName="GetValues" 
                            ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="local:TCellPhenotype" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <CollectionViewSource x:Key="cellsetRegionsListView"  
                                  Source="{Binding Path=scenario.regions}"/>

            <CollectionViewSource x:Key="boxSpecsListView"  
                                  Source="{Binding Path=entity_repository.box_specifications}"/>

            <CollectionViewSource x:Key="ggBoxSpecsListView"  
                                  Source="{Binding Path=entity_repository.box_specifications}"/>

            <CollectionViewSource x:Key="solfacGaussianSpecsListView"  
                                  Source="{Binding Path=entity_repository.gaussian_specifications}"/>

            <CollectionViewSource x:Key="cellsetCellTypesListView"  
                                  Source="{Binding Path=entity_repository.cell_subsets}"/>

            <CollectionViewSource x:Key="solfacSolfacTypesListView"  
                                  Source="{Binding Path=entity_repository.solfac_types}"/>
            
            <!-- skg 5/29/12 -->
            <CollectionViewSource x:Key="baseCellTypesListView"  
                                  Source="{Binding Path=entity_repository.CellBaseTypeLabel}"/>

            <CollectionViewSource x:Key="bPhenotypesListView"  
                                  Source="{Binding Path=entity_repository.BCellPhenotype}"/>
            <CollectionViewSource x:Key="tPhenotypesListView"  
                                  Source="{Binding Path=entity_repository.TCellPhenotype}"/>

            <!-- Style for visibility checkboxes in list views -->
            <Style x:Key="EyeballCheckboxStyle" TargetType="CheckBox">
                <Setter Property="SnapsToDevicePixels" Value="true"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type CheckBox}">
                            <Grid Width="13" Height="13">
                                <Image x:Name="_image" Source="Images/cartoonEyeClosed.png" Opacity="0.6"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="_image" Property="Source" Value="Images/cartoonEyeOpen.png"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="_image" Property="Opacity" Value="0.2" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!-- skg 7/26/12-->
            <sys:Int32 x:Key="ToolTipInitialShowDelay">100</sys:Int32>
            <Style TargetType="TextBlock">
                <Setter Property="ToolTipService.InitialShowDelay" Value="{StaticResource ToolTipInitialShowDelay}"/>
            </Style>
            
            <!-- skg Monday, April 29, 2013 -->
            <Style x:Key="ExpanderHeaderFocusVisual">
                <Setter Property="Control.Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <Border>
                                <Rectangle SnapsToDevicePixels="true"
                           Margin="0"
                           Stroke="Black"
                           StrokeDashArray="1 2"
                           StrokeThickness="1" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="ExpanderDownHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderRightHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Top"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderUpHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderLeftHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Top"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ArrowlessExpanderTemplate"
       TargetType="{x:Type Expander}">
                <Setter Property="Foreground"
            Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
                <Setter Property="Background"
            Value="Transparent" />
                <Setter Property="HorizontalContentAlignment"
            Value="Stretch" />
                <Setter Property="VerticalContentAlignment"
            Value="Stretch" />
                <Setter Property="BorderBrush"
            Value="Transparent" />
                <Setter Property="BorderThickness"
            Value="1" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Expander}">
                            <Border SnapsToDevicePixels="true"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="3">
                                <DockPanel>
                                    <ToggleButton FontFamily="{TemplateBinding FontFamily}"
                                      FontSize="{TemplateBinding FontSize}"
                                      FontStretch="{TemplateBinding FontStretch}"
                                      FontStyle="{TemplateBinding FontStyle}"
                                      FontWeight="{TemplateBinding FontWeight}"
                                      Foreground="{TemplateBinding Foreground}"
                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                      Padding="{TemplateBinding Padding}"
                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                      FocusVisualStyle="{StaticResource ExpanderHeaderFocusVisual}"
                                      Margin="1"
                                      MinHeight="0"
                                      MinWidth="0"
                                      x:Name="HeaderSite"
                                      Style="{StaticResource ExpanderDownHeaderStyle}"
                                      Content="{TemplateBinding Header}"
                                      ContentTemplate="{TemplateBinding HeaderTemplate}"
                                      ContentTemplateSelector="{TemplateBinding HeaderTemplateSelector}"
                                      DockPanel.Dock="Top"
                                      IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" />
                                    <ContentPresenter Focusable="false"
                                          Visibility="Collapsed"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          Margin="{TemplateBinding Padding}"
                                          x:Name="ExpandSite"
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                          DockPanel.Dock="Bottom" />
                                </DockPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsExpanded"
                             Value="true">
                                    <Setter Property="Visibility"
                                TargetName="ExpandSite"
                                Value="Visible" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Right">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Right" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Left" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderRightHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Up">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Top" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Bottom" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderUpHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Left">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Left" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Right" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderLeftHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="IsEnabled"
                             Value="false">
                                    <Setter Property="Foreground"
                                Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- =========================== -->
            <!-- Box Specification -->
            <DataTemplate x:Key="boxSpecDetailsTemplate">
                <Grid Margin="0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Grid.Column="0" Grid.Row="0"
                          VerticalAlignment="Center">
                        <Rectangle Fill="White"
                                   Stroke="Black"
                                   StrokeThickness="0.5"
                                   Width="15"
                                   Height="15"
                                   />
                        <CheckBox x:Name="box_widget_on_checkbox"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                    Style="{StaticResource EyeballCheckboxStyle}"
                                    IsChecked="{Binding Path=box_visibility}"
                                    />
                    </Grid>
                    <TextBlock Text="center (µm)" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Margin="5,4" HorizontalAlignment="Right"/>
                    <TextBlock Text="size (µm)" Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="0" Margin="3,4" HorizontalAlignment="Right"/>
                    <!--<Line Margin="4,0,4,3" 
                          Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />
                    <Line Margin="4,0,4,3" 
                          Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />-->
                    <TextBlock Text="X" Grid.Column="0" Grid.Row="2" Margin="2,0" TextAlignment="Right"/>
                    <Slider x:Name="x_trans_slider"
                            Grid.Column="1" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_trans_min}" 
                            Maximum="{Binding Path=x_trans_max}"
                            Value="{Binding Path=x_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="x_scale_slider"
                            Grid.Column="3" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_scale_min}" 
                            Maximum="{Binding Path=x_scale_max}"
                            Value="{Binding Path=x_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Y" Grid.Column="0" Grid.Row="3" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="y_trans_slider"
                            Grid.Column="1" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_trans_min}" 
                            Maximum="{Binding Path=y_trans_max}"
                            Value="{Binding Path=y_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="y_scale_slider"
                            Grid.Column="3" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_scale_min}" 
                            Maximum="{Binding Path=y_scale_max}"
                            Value="{Binding Path=y_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Z" Grid.Column="0" Grid.Row="4" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="z_trans_slider"
                            Grid.Column="1" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_trans_min}" 
                            Maximum="{Binding Path=z_trans_max}"
                            Value="{Binding Path=z_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="z_scale_slider"
                            Grid.Column="3" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_scale_min}" 
                            Maximum="{Binding Path=z_scale_max}"
                            Value="{Binding Path=z_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                </Grid>
            </DataTemplate>

            <!-- Gaussian Box Specification -->
            <DataTemplate x:Key="gaussBoxSpecDetailsTemplate">
                <Grid Margin="0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Grid.Column="0" Grid.Row="0"
                          VerticalAlignment="Center">
                        <Rectangle Fill="White"
                                   Stroke="Black"
                                   StrokeThickness="0.5"
                                   Width="15"
                                   Height="15"
                                   />
                        <CheckBox x:Name="box_widget_on_checkbox"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                    Style="{StaticResource EyeballCheckboxStyle}"
                                    IsChecked="{Binding Path=box_visibility}"
                                    />
                    </Grid>
                    <TextBlock Text="center (µm)" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Margin="5,4" HorizontalAlignment="Right"/>
                    <TextBlock Text="width (µm)" Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="0" Margin="3,4" HorizontalAlignment="Right"/>
                    <!--<Line Margin="4,0,4,3" 
                          Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />
                    <Line Margin="4,0,4,3" 
                          Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />-->
                    <TextBlock Text="X" Grid.Column="0" Grid.Row="2" Margin="2,0" TextAlignment="Right"/>
                    <Slider x:Name="x_trans_slider"
                            Grid.Column="1" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_trans_min}" 
                            Maximum="{Binding Path=x_trans_max}"
                            Value="{Binding Path=x_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="x_scale_slider"
                            Grid.Column="3" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_scale_min}" 
                            Maximum="{Binding Path=x_scale_max}"
                            Value="{Binding Path=x_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Y" Grid.Column="0" Grid.Row="3" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="y_trans_slider"
                            Grid.Column="1" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_trans_min}" 
                            Maximum="{Binding Path=y_trans_max}"
                            Value="{Binding Path=y_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="y_scale_slider"
                            Grid.Column="3" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_scale_min}" 
                            Maximum="{Binding Path=y_scale_max}"
                            Value="{Binding Path=y_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Z" Grid.Column="0" Grid.Row="4" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="z_trans_slider"
                            Grid.Column="1" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_trans_min}" 
                            Maximum="{Binding Path=z_trans_max}"
                            Value="{Binding Path=z_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="z_scale_slider"
                            Grid.Column="3" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_scale_min}" 
                            Maximum="{Binding Path=z_scale_max}"
                            Value="{Binding Path=z_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:MolPopHomogeneousLevel}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="peak conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="10"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:MolPopLinearGradient}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="min conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=min_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="max conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="1"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="1"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=max_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="direction" Margin="6,0"
                               Grid.Column="0" Grid.Row="2"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <Grid Grid.Column="1" Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="X" 
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <TextBlock Text="Y" 
                               Grid.Column="1" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <TextBlock Text="Z" 
                               Grid.Column="2" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <editors:DoubleEditBox Grid.Column="0" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=x_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <editors:DoubleEditBox Grid.Column="1" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=y_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <editors:DoubleEditBox Grid.Column="2" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=z_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:MolPopGaussianGradient}">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="peak conc" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <StackPanel Orientation="Horizontal"
                                    Grid.Column="1" Grid.Row="0"
                                    Margin="0,2">
                            <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                    SpinnerVisibility="Collapsed"
                                                    HorizontalAlignment="Right"
                                                    Format="G"
                                                    StepValue="10"
                                                    Width="50" 
                                                    CenterSlotHorizontalAlignment="Right"
                                                    Value="{Binding Path=peak_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                    />
                            <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                        </StackPanel>
                        <TextBlock Text="gauss" Margin="6,0"
                                   Grid.Column="0" Grid.Row="1"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <ComboBox Name="gaussian_gradients_cbox"
                                                  Grid.Column="1" Grid.Row="1" 
                                                  ItemsSource="{Binding Source={StaticResource solfacGaussianSpecsListView}}" 
                                                  DisplayMemberPath="gaussian_spec_name"
                                                  SelectedValue="{Binding Path=gaussgrad_gauss_spec_guid_ref}"
                                                  SelectedValuePath="gaussian_spec_box_guid_ref"
                                                  MaxWidth="150"
                                                  />
                    </Grid>
                    <!-- ListView as level of indirection for getting to the correct BoxSpec -->
                    <ListView x:Name="solfacGaussianBoxSpecsListView"
                                              ItemsSource="{Binding Source={StaticResource ggBoxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=gaussgrad_gauss_spec_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="GaussianBoxSpecDetails"
                                                    Content="{Binding ElementName=solfacGaussianBoxSpecsListView, Path=SelectedItem}" 
                                                    HorizontalAlignment="Center"
                                                    ContentTemplate="{StaticResource gaussBoxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="molpopDistributionDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <ContentControl Name="solfac_dist_cc"
                                    Grid.ColumnSpan="2" Grid.Row="0"
                                    Margin="0,6"
                                    BorderBrush="DarkGray" BorderThickness="1"
                                    Content="{Binding Path=mpInfo.mp_distribution}"
                                    />
                </Grid>
            </DataTemplate>


            <!-- =========================== -->
            <!-- Mol Pops -->

            <DataTemplate x:Key="molListItemTemplate">
                <StackPanel Orientation="Horizontal">                    
                    <TextBlock Text="{Binding Path=Name}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>
            
            <!-- skg daphne -->
            <!-- Reaction -->
            <DataTemplate x:Key="reacListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=TotalReactionString}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>


            <!-- =========================== -->
            <!-- Regions -->            

            <DataTemplate x:Key="regionListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <CheckBox IsChecked="{Binding Path=region_visibility}" Style="{StaticResource EyeballCheckboxStyle}"/>
                    <Rectangle Width="10" Height="10"
                               Margin="5,0,0,0"
                               VerticalAlignment="Center"
                               Fill="{Binding Path=region_color, Converter={StaticResource colorToSolidBrushConv}}"
                               Stroke="Black" StrokeThickness="0.5"/>
                    <TextBlock Text="{Binding Path=region_name}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="regionDetailsTemplate">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="name" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <TextBox Text="{Binding Path=region_name, UpdateSourceTrigger=PropertyChanged}"
                                 Grid.Column="1" Grid.Row="0"
                                 Margin="0,2"
                                 />
                        <TextBlock Text="type" Margin="6,0"
                                   Grid.Column="0" Grid.Row="1"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <ComboBox ItemsSource="{Binding Source={StaticResource regionShapesEnum}}"
                                  Grid.Column="1" Grid.Row="1"
                                  SelectedValue="{Binding Path=region_type}"
                                  IsSynchronizedWithCurrentItem="true" 
                                  Margin="0,2"
                                  />
                        <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="3"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <editors:ColorEditBox x:Name="regionColorEditBox"
                                          Grid.Column="1" Grid.Row="3"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=region_color}"
                                          Margin="0,2"
                                          />
                    </Grid>
                    <!-- ListView as level of indirection for getting to the correct BoxSpec -->
                    <ListView Name="regionSpecsListView"
                                              Grid.Column="1" Grid.Row="1"
                                              ItemsSource="{Binding Source={StaticResource boxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=region_box_spec_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="RegionBoxSpecDetails"
                                                    HorizontalAlignment="Center"
                                                    Content="{Binding ElementName=regionSpecsListView, Path=SelectedItem}" 
                                                    ContentTemplate="{StaticResource boxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Cell Population -->

            <DataTemplate x:Key="cellListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <!--<CheckBox IsChecked="{Binding Path=cellpopulation_render_on}" Style="{StaticResource EyeballCheckboxStyle}"/>-->
                    <Rectangle Width="10" Height="10"
                                               Margin="5,0,0,0"
                                               VerticalAlignment="Center"
                                               Fill="{Binding Path=cellpopulation_color, Converter={StaticResource colorToSolidBrushConv}}"
                                               Stroke="Black" StrokeThickness="0.5"/>
                    <TextBlock Text="{Binding Path=number}" Margin="5,0,0,0"/>
                    <TextBlock Text=" " />
                    <!--<TextBlock Text="{Binding Path=cell_subset_guid_ref, 
                                                                Converter={StaticResource CellTypeGUIDtoNameConv}, 
                                                                ConverterParameter={StaticResource cellsetCellTypesListView}}" />-->
                    <StackPanel Orientation="Horizontal">
                        <!-- Only want an "s" to show up if more than one cell -->
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="s" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <!-- Only want a region name to show up if cells are constrained to region -->
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=cellpopulation_constrained_to_region}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=cellpopulation_constrained_to_region}" Value="False">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding Path=wrt_region, 
                                                                Converter={StaticResource RelativePosEnumConv}}" />
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding Path=cellpopulation_region_guid_ref, 
                                                                Converter={StaticResource RegionGUIDtoNameConv}, 
                                                                ConverterParameter={StaticResource cellsetRegionsListView}}" />
                    </StackPanel>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="cellDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBlock Text="name" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center" />
                    <TextBox Text="{Binding Path=cellpopulation_name, UpdateSourceTrigger=PropertyChanged}"
                                 Grid.Column="1" Grid.Row="0"  Margin="0,2"   />
                    <TextBlock Text="number" Margin="6,0"
                                   Grid.Column="0" Grid.Row="2"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"  />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="2"
                                Margin="0,4">
                        <Slider x:Name="number_slider"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Width="100"
                                RenderTransform="1.0,0,0,0.5,0,6"
                                Minimum="1" 
                                Maximum="10000" 
                                Value="{Binding Path=number}" 
                                IsSnapToTickEnabled="True" 
                                TickFrequency="1" 
                                KeyboardNavigation.IsTabStop="False"
                                />
                        <editors:Int32EditBox CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Right"
                                            Format="N0"
                                            StepValue="10"
                                            Width="40" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding ElementName=number_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    </StackPanel>
                    <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="3"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                    <editors:ColorEditBox x:Name="cellColorEditBox"
                                          Grid.Column="1" Grid.Row="3"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=cellpopulation_color}"
                                          Margin="0,2"
                                          />
                    <CheckBox Name="constrain_to_region_checkbox"
                              Content="Constrain to region"
                              Grid.ColumnSpan="2" Grid.Row="4"
                              Margin="0,6"
                              IsChecked="{Binding Path=cellpopulation_constrained_to_region}"
                              />
                    <TextBlock Text="region" Margin="6,0"
                               Grid.Column="0" Grid.Row="5"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               IsEnabled="{Binding ElementName=constrain_to_region_checkbox, Path=IsChecked}"
                               />
                    <ComboBox Name="cell_region_cbox"
                              Grid.Column="1" Grid.Row="5" 
                              IsEnabled="{Binding ElementName=constrain_to_region_checkbox, Path=IsChecked}"
                              MinWidth="80"
                              ItemsSource="{Binding Source={StaticResource cellsetRegionsListView}}" 
                              DisplayMemberPath="region_name"
                              SelectedValue="{Binding Path=cellpopulation_region_guid_ref}"
                              SelectedValuePath="region_box_spec_guid_ref"
                              />
                    <TextBlock Text="placement" Margin="6,0"
                               Grid.Column="0" Grid.Row="6"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               IsEnabled="{Binding ElementName=constrain_to_region_checkbox, Path=IsChecked}"
                               />
                    <ComboBox Grid.Column="1" Grid.Row="6"
                                  ItemsSource="{Binding Source={StaticResource relativePosition}}"
                                  SelectedValue="{Binding Path=wrt_region}"
                                  IsSynchronizedWithCurrentItem="true" 
                                  MinWidth="120"
                                  IsEnabled="{Binding ElementName=constrain_to_region_checkbox, Path=IsChecked}"
                                  />
                </Grid>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Cell Subsets -->
            
            <!-- skg 6/2/12 -->
            <!--<DataTemplate x:Key="cellSubsetTypeReceptorItemTemplate">
                <TextBlock Text="{Binding Path=receptor_solfac_type_guid_ref, 
                                              Converter={StaticResource SolfacGUIDtoReceptorNameConv}, 
                                              ConverterParameter={StaticResource solfacSolfacTypesListView}}"
                               HorizontalAlignment="Left"
                               />
            </DataTemplate>-->
            
            <Style TargetType="editors:DoubleEditBox">
                <Setter Property="CheckBoxVisibility" Value="Collapsed" />
                <Setter Property="SpinnerVisibility" Value="Collapsed" />
                <Setter Property="HorizontalAlignment" Value="Left" />
                <Setter Property="Format" Value="G" />
                <Setter Property="Minimum" Value="0" />
                <Setter Property="Width" Value="60" />
                <Setter Property="CenterSlotHorizontalAlignment" Value="Right" />
            </Style>
            
            
            <DataTemplate x:Key="cellTypeListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=cell_subset_type.cell_subset_name}"/>
                </StackPanel>
            </DataTemplate>
            
            <DataTemplate x:Key="cellTypeReceptorItemTemplate">
                <TextBlock Text="{Binding Path=receptor_solfac_type_guid_ref, 
                                              Converter={StaticResource SolfacGUIDtoReceptorNameConv}, 
                                              ConverterParameter={StaticResource solfacSolfacTypesListView}}"
                               HorizontalAlignment="Left"
                               />
            </DataTemplate>

            

            <!-- =========================== -->
            <!-- Mol Pop Distributions -->            
            <DataTemplate x:Key="molpopDistributionTypeTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Converter={StaticResource SolfacDistTypeEnumConv}}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="solfacTimeAmpListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Time="/>
                    <TextBlock Text="{Binding Path=time_value}"/>
                    <TextBlock Text=", Amp="/>
                    <TextBlock Text="{Binding Path=amplitude}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:MolPopCustomGradient}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="file name" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <TextBlock Text="{Binding Path=custom_gradient_file_name}"
                                   Width="150"
                                   Background="LightGray"
                                   VerticalAlignment="Center"
                                   Padding="4,0"
                                   />
                        <Button Content="..." VerticalAlignment="Center" HorizontalAlignment="Right" 
                                Width="25" Margin="2,0,0,0"
                                Click="SolfacCustomGradientFile_Click"
                                ToolTip="Choose a new custom chemokine gradient file"
                                />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="MolPopDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="name" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                    <TextBox Text="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}"
                                 Grid.Column="1" Grid.Row="0"
                             Margin="0,2"
                                 />
                    
                    <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="2"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                    <editors:ColorEditBox x:Name="solfacColorEditBox"
                                          Grid.Column="1" Grid.Row="2"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=mpInfo.mp_color}"
                                          Margin="0,2"
                                          />
                    <TextBlock Text="render wt" Margin="6,0"
                               Grid.Column="0" Grid.Row="3"
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   TextAlignment="Right"
                                    />
                    <StackPanel Orientation="Horizontal" Grid.Column="1" Grid.Row="3"
                                IsEnabled="{Binding Path=mp_render_on}">
                        <Slider x:Name="solfac_weight_slider"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Width="50"
                                    RenderTransform="1.0,0,0,0.5,0,7"
                                    Minimum="0" 
                                    Maximum="5" 
                                    Value="{Binding Path=mpInfo.mp_render_blending_weight}" 
                                    IsSnapToTickEnabled="True" 
                                    TickFrequency="0.1" 
                                    />
                        <TextBlock Text="{Binding ElementName=solfac_weight_slider, Path=Value}" 
                                   VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   Margin="5,0,0,0"
                                   MinWidth="20"
                                   />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="reactionDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="rate constant" Margin="6,0"
                            Grid.Column="0" Grid.Row="0"  
                            HorizontalAlignment="Right" VerticalAlignment="Center"
                            />

                    <TextBox Margin="0,2" x:Name="txtRateConst"
                            Grid.Column="1" Grid.Row="0" 
                            Text="{Binding Path=RateConst, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                             IsReadOnly="True" />

                    <TextBlock Text="reaction type" Margin="6,0"
                            Grid.Column="0" Grid.Row="1"  
                            HorizontalAlignment="Right" VerticalAlignment="Center"
                            />

                    <TextBox Margin="0,2" x:Name="txtReactionType"
                            Grid.Column="1" Grid.Row="1"  
                                Text="{Binding Path=ReacTypeString, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                             IsReadOnly="True" />

                    
                </Grid>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Gaussian Specifications -->

            <DataTemplate x:Key="gaussianSpecListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <CheckBox IsChecked="{Binding Path=gaussian_region_visibility}" Style="{StaticResource EyeballCheckboxStyle}" />
                    <Rectangle Width="10" Height="10"
                               Margin="5,0,0,0"
                               VerticalAlignment="Center"
                               Fill="{Binding Path=gaussian_spec_color, Converter={StaticResource colorToSolidBrushConv}}"
                               Stroke="Black" StrokeThickness="0.5"/>
                    <TextBlock Text="{Binding Path=gaussian_spec_name}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="gaussianSpecDetailsTemplate">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="name" Margin="6,0"
                                       Grid.Column="0" Grid.Row="0"  
                                       HorizontalAlignment="Right" VerticalAlignment="Center"
                                       />
                        <TextBox Text="{Binding Path=gaussian_spec_name, UpdateSourceTrigger=PropertyChanged}"
                                     Grid.Column="1" Grid.Row="0"
                                     />
                        <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="3"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <editors:ColorEditBox x:Name="gaussSpecColorEditBox"
                                          Grid.Column="1" Grid.Row="3"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=gaussian_spec_color}"
                                              Margin="0,2"
                                          />
                    </Grid>
                    <ListView Name="ggBoxSpecsListView"
                                              ItemsSource="{Binding Source={StaticResource boxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=gaussian_spec_box_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="GGBoxSpecDetails"
                                                    Content="{Binding ElementName=ggBoxSpecsListView, Path=SelectedItem}" 
                                                    HorizontalAlignment="Center"
                                                    ContentTemplate="{StaticResource gaussBoxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Global Paramter Types -->

            <DataTemplate x:Key="globalParamterTypeListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=global_parameter_type, Converter={StaticResource GlobalParameterTypeEnumConv}}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="globalParameterTypeDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <ContentControl x:Name="global_params_detail_cc"
                                        Grid.ColumnSpan="2" Grid.Row="1"
                                        Content="{Binding}"
                                        />
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:ForceParams}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="130" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="rupture distance" Grid.Column="0" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0"/>
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="0"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=force_delta, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm" Grid.Column="2" Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="penetration resistance" Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="1"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=force_phi1, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm^2/min^2" Grid.Column="2" Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="adhesion constant" Grid.Column="0" Grid.Row="2" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="2"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=force_phi2, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="/min^2" Grid.Column="2" Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:LocomotorParams}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="110" />
                        <ColumnDefinition Width="45" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="drag" Grid.Column="0" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0"/>
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="0"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=loco_gamma, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="/min" Grid.Column="2" Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="locomotive force" Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="1"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=loco_sigma, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm/min^2" Grid.Column="2" Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="reorientation rate" Grid.Column="0" Grid.Row="2" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="2"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=loco_zeta, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="/min" Grid.Column="2" Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="chemotaxis coeff" Grid.Column="0" Grid.Row="3" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="3"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=loco_chi, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm^4/molec/min^3" Grid.Column="2" Grid.Row="3" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type local:SynapseParams}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="110" />
                        <ColumnDefinition Width="45" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="alpha" Grid.Column="0" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0"/>
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="0"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=Alpha, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="/min" Grid.Column="2" Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="beta" Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="1"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=Beta, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm/min^2" Grid.Column="2" Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    
                    <!---->
                    <TextBlock Text="delta" Grid.Column="0" Grid.Row="2" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="2"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=Delta, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm^4/molec/min^3" Grid.Column="2" Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    
                    <!---->
                    <TextBlock Text="epsilon" Grid.Column="0" Grid.Row="3" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="3"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=Epsilon, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="µm^4/molec/min^3" Grid.Column="2" Grid.Row="3" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                    <!---->
                    <TextBlock Text="kappa" Grid.Column="0" Grid.Row="4" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0" />
                    <editors:DoubleEditBox Grid.Column="1" Grid.Row="4"
                                            CheckBoxVisibility="Collapsed" 
                                            SpinnerVisibility="Collapsed"
                                            HorizontalAlignment="Left"
                                            Format="G"
                                            Width="50" 
                                            CenterSlotHorizontalAlignment="Right"
                                            Value="{Binding Path=Kappa, UpdateSourceTrigger=PropertyChanged}"
                                            />
                    <TextBlock Text="/min" Grid.Column="2" Grid.Row="4" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0"/>
                </Grid>
            </DataTemplate>


        </TabControl.Resources>

        <!-- SIM SETUP -->        
        <TabItem Header="Sim Setup">        
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="8">

                    <!-- Experiment -->
                    <TextBlock Text="Experiment name" FontWeight="Bold" Margin="0,5,0,0" />
                    <TextBox Text="{Binding Path=experiment_name, UpdateSourceTrigger=PropertyChanged}" x:Name="experiment_name_box"/>

                    <TextBlock Text="Description" FontWeight="Bold" Margin="0,10,0,0" />
                    <TextBox Text="{Binding Path=experiment_description, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap"
                                        Height="40" MaxWidth="{Binding ElementName=experiment_name_box, Path=ActualWidth}"
                                        VerticalScrollBarVisibility="Auto"/>

                    <!-- TimeConfig -->
                    <TextBlock Text="Time configuration" FontWeight="Bold" Margin="0,10,0,0" />
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="total time" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="time_duration_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0" 
                                                Maximum="28800" 
                                                Value="{Binding Path=scenario.time_config.duration}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="10" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="TimeDurationReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="F0"
                                                              StepValue="100"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=time_duration_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="rendering interval" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="3"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="time_step_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0.1" 
                                                Maximum="10" 
                                                Value="{Binding Path=scenario.time_config.rendering_interval}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="0.1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="TimeStepReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N1"
                                                              StepValue="0.1"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=time_step_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <!--*************************************************-->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="sampling interval" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="4"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="sampling_interval_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0" 
                                                Maximum="2000" 
                                                Value="{Binding Path=scenario.time_config.sampling_interval}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="SamplingInterval" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=sampling_interval_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="repetitions" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="5"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="exp_rep_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="1" 
                                                Maximum="50" 
                                                Value="{Binding Path=experiment_reps}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:Int32EditBox x:Name="ExpRepReadout" 
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding ElementName=exp_rep_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="times" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
        
        <!-- Extracellular Medium -->
        <TabItem Header="Extracellular Medium">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Name="ConfigStackPanel" Orientation="Vertical" Margin="8">

                    <!-- Environment -->
                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Extracellular Medium Extents"                                              
                                                    x:Name="EnvironmentExpander"
                                                    Margin="0,5,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>

                        <TextBlock Text="Extracellular Medium Extents" FontWeight="Bold" Margin="0,-10,0,0" />
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="X" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                        <Slider Name="extent_x_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                Value="{Binding Path=scenario.environment.extent_x}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="ExtentXReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="40" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=extent_x_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Y" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                        <Slider Name="extent_y_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                Value="{Binding Path=scenario.environment.extent_y}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="ExtentYReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="40" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=extent_y_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Z" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                        <Slider Name="extent_z_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                Value="{Binding Path=scenario.environment.extent_z}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="ExtentZReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="40" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=extent_z_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>

                        </StackPanel>
                    </Expander>
                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Molecular Populations"                                              
                                                    x:Name="MolPopsExpander"
                                                    Margin="0,5,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>

                            <!-- Molecular Populations -->                            
                            <StackPanel>
                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to create a population of cells from a subset defined below. 
                                    Specify the number of cells, their color and the region (from above) that will contain these cells.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Molecular Populations" FontWeight="Bold" Margin="0,-10,0,0" >
                                </TextBlock>

                            </StackPanel>
                            <ListBox x:Name="MolPopsListBox" MinHeight="50" 
                                         ItemsSource="{Binding Path=scenario.MolPops}" 
                                         ItemTemplate="{Binding Source={StaticResource molListItemTemplate}}"
                                         SelectedIndex="0"
                            />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddMolButton"  Width="50" Content="Add" Click="AddMolButton_Click"/>
                                <Button Name="RemoveMolButton" Width="50" Content="Remove" Click="RemoveMolButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Details"
                                              x:Name="MolDetailsExpander"
                                              Margin="0,-15,0,0" 
                                              Canvas.ZIndex="1"
                                              >

                                <StackPanel Orientation="Vertical">
                                    <ContentControl Name="MolPopDetails"
                                                Content="{Binding ElementName=MolPopsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource MolPopDetailsTemplate}" 
                                                Margin="6"/>
                                    <Grid Margin="6,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>

                                        <!---->
                                <TextBlock Text="Molecule" Margin="6,0" 
                                   Grid.Column="0" Grid.Row="0" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                <ComboBox x:Name="molecule_combo_box"
                                        Grid.Column="1" Grid.Row="0" Margin="0,2"
                                        MinWidth="80"
                                        ItemsSource="{Binding PredefMolecules}" 
                                                                                
                                        SelectedItem="{Binding ElementName=MolPopsListBox, Path=SelectedItem.Molecule,  Mode=TwoWay}"
                                        DisplayMemberPath="Name"  
                                          
                                        />
                                <!---->
                                        <!--SelectedValue="{Binding Path=Molecule.Name, Mode=TwoWay}"-->

                                        <TextBlock Text="dist" Margin="6,0" 
                                               Grid.Column="0" Grid.Row="1" 
                                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1" Grid.Row="1"
                                                Name="SolfacDistributionTypeComboBox"
                                                ItemsSource="{Binding Source={StaticResource molpopDistributionTypes}}"
                                                ItemTemplate="{Binding Source={StaticResource molpopDistributionTypeTemplate}}"
                                                SelectedValue="{Binding Path=mp_distribution_type, Mode=OneWay}"
                                                SelectionChanged="SolfacDistributionComboBox_SelectionChanged"
                                                MinWidth="120"
                                                />
                                    </Grid>
                                    <ContentControl Name="SolfacDistributionDetails"
                                                Content="{Binding ElementName=MolPopsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource molpopDistributionDetailsTemplate}" 
                                                Margin="6,2"/>

                                </StackPanel>

                            </Expander>
                        </StackPanel>
                    </Expander>

                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Reactions"                                              
                                                    x:Name="ReacExpander"
                                                    Margin="0,5,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>
                            <!-- Reactions -->
                            <StackPanel>
                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to add a reaction to the extracellular medium from a list of reactions in the list box below.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Reactions" FontWeight="Bold" Margin="0,-10,0,0" >
                                </TextBlock>

                            </StackPanel>
                            <ListBox x:Name="ReacListBox" MinHeight="50" 
                                         ItemsSource="{Binding Path=scenario.Reactions}" 
                                         ItemTemplate="{Binding Source={StaticResource reacListItemTemplate}}"
                                         SelectedIndex="0"
                         />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="RemoveReacButton" Width="50" Content="Remove" Click="RemoveReacButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Details"
                                              x:Name="ReacDetailsExpander"
                                              Margin="0,-15,0,0" 
                                              Canvas.ZIndex="1"
                                              >

                                <StackPanel Orientation="Vertical">


                                    <ContentControl Name="ReactionDetails"
                                                Content="{Binding ElementName=ReacListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource reactionDetailsTemplate}" 
                                                Margin="6"/>

                                    

                                </StackPanel>

                            </Expander>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Add a reaction"
                                              x:Name="AddReacExpander"
                                              Margin="0,0,0,0" 
                                              Canvas.ZIndex="1"
                                              >
                                <StackPanel Orientation="Vertical" Margin="10,0">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="reactionListItemTemplate">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Path=TotalReactionString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>
                                    <TextBlock Text="Reactions Library" Grid.Column="0" Grid.Row="3"  FontWeight="Bold"  Margin="0,0,6,0" />
                                    <ListBox x:Name="lbAvailableReacs" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                                            ItemsSource="{Binding Path=PredefReactions, Mode=TwoWay}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource reactionListItemTemplate}}"
                                                            SelectedIndex="0"
                                                            >
                                    </ListBox>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                        <Button Name="AddReacButton"  Width="50" Content="Add" Click="AddReacButton_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>


                        </StackPanel>
                    </Expander>

                    <Expander
                        Padding="5" 
                        ExpandDirection="Down"
                            IsExpanded="False"
                            Header="Reaction Complexes"                                            
                            x:Name="ReacCompExpander"
                            Margin="0,5,0,0" 
                            Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>
                            
                            <StackPanel>
                                <StackPanel.Resources>
                                    <DataTemplate x:Key="reacComplexListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </StackPanel.Resources>

                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                        Click Add button to add a reaction complex to the extracellular medium from a list of reactions complexes in the list box below.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Reaction Complexes" Margin="0,-10,0,0" >
                                </TextBlock>
                        
                                <ListBox x:Name="ReactionComplexListBox" MinHeight="50" 
                                    ItemsSource="{Binding Path=scenario.ReactionComplexes}" 
                                    ItemTemplate="{Binding Source={StaticResource reacComplexListItemTemplate}}"
                                    SelectedIndex="0"
                                 />

                            </StackPanel>
                    
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddReacCompExpandButton"  Width="50" Content="Add" Click="AddReacCompExpandButton_Click"/>
                                <Button Name="RemoveReacCompButton" Width="50" Content="Remove" Click="RemoveReacCompButton_Click" />
                            </StackPanel>

                            
                            
                            
                            <Expander ExpandDirection="Down"
                                IsExpanded="False"
                                Header="Add reaction complex"
                                x:Name="AddReacCxExpander"
                                Margin="0,5,0,0" 
                                Canvas.ZIndex="1"
                                BorderThickness="1"
                                BorderBrush="Black"
                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >
                                              
                                <StackPanel Orientation="Vertical" Margin="10,0">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="reacCxListItemTemplate">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Path=Name}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    
                                        <DataTemplate x:Key="addReacComplexDetailsTemplate">
                                            <StackPanel>                                                
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Reactions in selected Complex" Grid.Column="0" Grid.Row="3"  Margin="0,-10,0,0" />
                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,5,0" AlternationCount="2"                                                        
                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                        DisplayMemberPath="TotalReactionString" >
                                                    </ListBox>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>
                                    
                                    <TextBlock Text="Reaction Complexes Library"  Margin="0,0,6,0" />
                                    <ListBox x:Name="lbAvailableReacCx" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                        ItemsSource="{Binding Path=PredefReactionComplexes, Mode=TwoWay}"                                                      
                                        ItemTemplate="{Binding Source={StaticResource reacCxListItemTemplate}}"
                                        SelectedIndex="0"
                                        >
                                    </ListBox>
                                    <StackPanel Orientation="Vertical" HorizontalAlignment="Right" Margin="0,0,6,0" Canvas.ZIndex="10">
                                        <Button Name="AddReacCxButton"  Width="50" Content="Add" Click="AddReacCompButton_Click"/>
                                    </StackPanel>

                                    <ContentControl Name="AddReactionComplexDetails"
                                        Content="{Binding ElementName=lbAvailableReacCx, Path=SelectedItem}" 
                                        ContentTemplate="{StaticResource addReacComplexDetailsTemplate}" 
                                        Margin="6"/>
                                
                                </StackPanel>
                            </Expander>

                            <Expander ExpandDirection="Down"
                                    IsExpanded="False"
                                    Header="Details"
                                    x:Name="ReactionComplexDetailsExpander"
                                    Margin="0,5,0,0" 
                                    Canvas.ZIndex="1"
                                    BorderThickness="1"
                                    BorderBrush="Black"
                                    Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >                                

                                <StackPanel Orientation="Vertical">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="reactionComplexDetailsTemplate">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Reaction Complex Name" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="6,0" />
                                                    <TextBox Margin="0,2" x:Name="txtReacComplexName" Text="{Binding Path=Name, Mode=OneWay}" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Reactions" Grid.Column="0" Grid.Row="3"  Margin="5,0,0,0" />
                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="5,0,6,0" AlternationCount="2"                                                        
                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                        DisplayMemberPath="TotalReactionString" >
                                                    </ListBox>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>

                                    <ContentControl Name="ReactionComplexDetails"
                                        Content="{Binding ElementName=ReactionComplexListBox, Path=SelectedItem}" 
                                        ContentTemplate="{StaticResource reactionComplexDetailsTemplate}" 
                                        Margin="6"/>

                                </StackPanel>
                            </Expander>
                            
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- CELLS -->
        <TabItem Header="Cells">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="EntitiesStackPanel" Orientation="Vertical" Margin="8">

                    <!-- Regions -->
                    <Expander ExpandDirection="Down" Padding="10"
                            IsExpanded="False"
                            Header="Regions"
                            x:Name="RegionsExpander"
                            Margin="0,4,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                            >
                        <StackPanel>
                            <StackPanel>
                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" 
                                                            VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to define a 3D region inside the big cube.  This region will be populated with cells defined below.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <!--<TextBlock Text="Regions" FontWeight="Bold" Margin="0,5,0,0"  />-->
                            </StackPanel>
                            <ListBox x:Name="RegionsListBox" MinHeight="50" 
                                                 ItemsSource="{Binding Path=scenario.regions}"
                                                 ItemTemplate="{Binding Source={StaticResource regionListItemTemplate}}"
                                                 SelectedIndex="0"
                                                />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddRegionButton" Width="50" Content="Add" Click="AddRegionButton_Click" />
                                <Button Name="RemoveRegionButton" Width="50" Content="Remove" Click="RemoveRegionButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down"
                                    IsExpanded="False"
                                    Header="Details"
                                    x:Name="RegionsDetailsExpander"
                                    Margin="0,-15,0,0" 
                                    Canvas.ZIndex="1"
                                    >
                                <StackPanel Orientation="Vertical">
                                    <ContentControl Name="RegionDetails"
                                                                Content="{Binding ElementName=RegionsListBox, Path=SelectedItem}" 
                                                                ContentTemplate="{StaticResource regionDetailsTemplate}" 
                                                                Margin="8"/>
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </Expander>

                    <!-- CELL POPULATIONS -->
                    <!--<Line Margin="0,5" SnapsToDevicePixels="True" Stroke="LightGray"
                                                  Stretch="Fill" X1="0" X2="10" />-->

                    <Expander ExpandDirection="Down" Padding="10"
                            IsExpanded="False"
                            Header="Cell Populations"
                            x:Name="CellPopsExpander"
                            Margin="0,4,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                            >

                        <!--<StackPanel>
                            <StackPanel.ToolTip>
                                <StackPanel Width="200" Orientation="Horizontal">
                                    <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to create a population of cells from a subset defined below. 
                                    Specify the number of cells, their color and the region (from above) that will contain these cells.
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel.ToolTip>
                            <TextBlock Text="Cell Populations" FontWeight="Bold" Margin="0,5,0,0" >
                            </TextBlock>

                        </StackPanel>-->

                        <StackPanel>
                            <StackPanel.ToolTip>
                                <StackPanel Width="200" Orientation="Horizontal">
                                    <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to create a population of cells from a subset defined below. 
                                    Specify the number of cells, their color and the region (from above) that will contain these cells.
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel.ToolTip>
                            <ListBox x:Name="CellSetsListBox" MinHeight="50" 
                                             ItemsSource="{Binding Path=scenario.cellpopulations}" 
                                             ItemTemplate="{Binding Source={StaticResource cellListItemTemplate}}"
                                                 SelectedIndex="0"
                                             />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddCellButton"  Width="50" Content="Add" Click="AddCellButton_Click"/>
                                <Button Name="RemoveCellButton" Width="50" Content="Remove" Click="RemoveCellButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down" Padding="6"
                                    IsExpanded="False"
                                    Header="Cell Population Details"
                                    x:Name="CellsDetailsExpander"
                                    Margin="0,-15,0,0" 
                                    Canvas.ZIndex="1"
                                    
                                    >
                            <StackPanel Orientation="Horizontal">

                                <ContentControl Name="CellDetails"
                                                Content="{Binding ElementName=CellSetsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource cellDetailsTemplate}" 
                                                Margin="6,-4"/>

                                    <StackPanel Orientation="Vertical">
                                        <!-- This is for Mol Pop display and whether it is in cytoplasm or membrane -->
                                        <Expander ExpandDirection="Down" Padding="6"
                                            IsExpanded="False"
                                            Header="Molecular Populations"
                                            x:Name="MolPopExpander"
                                            Margin="0,-4,0,0" 
                                            Canvas.ZIndex="1"
                                            >
                                            <Grid>
                                                <Grid.Resources>
                                                    <DataTemplate x:Key="col2ListItemTemplate">
                                                        <CheckBox HorizontalAlignment="Center" IsChecked="{Binding Path=InCytosol}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="col3ListItemTemplate">
                                                        <CheckBox HorizontalContentAlignment="Center" IsChecked="{Binding Path=InMembrane}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="mpInfoDetailsTemplate">
                                                        <ListView Grid.Row="1" x:Name="lbMols" AlternationCount="2" ItemsSource="{Binding CellMolPops}">
                                                            <ListView.View>
                                                                <GridView x:Name="gvMols" >
                                                                    <GridViewColumn Width="Auto" Header="Name" DisplayMemberBinding="{Binding Name}"  />
                                                                    <GridViewColumn Width="Auto" Header="Cytosol" CellTemplate="{Binding Source={StaticResource col2ListItemTemplate}}"  />
                                                                    <GridViewColumn Width="Auto" Header="Membrane" CellTemplate="{Binding Source={StaticResource col3ListItemTemplate}}"   />
                                                                </GridView>
                                                            </ListView.View>
                                                        </ListView>
                                                    </DataTemplate>
                                                </Grid.Resources>

                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition MinHeight="170" Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition MaxWidth="250" />
                                                </Grid.ColumnDefinitions>

                                                <!--<TextBlock Grid.Row="0" Text="Molecular Populations" FontWeight="Bold" Margin="6,5,0,0" >
                                            </TextBlock>-->


                                                <ContentControl Grid.Row="1" Name="mpInfo"
                                                Content="{Binding ElementName=CellSetsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource mpInfoDetailsTemplate}" 
                                                Margin="6"/>
                                            </Grid>
                                        </Expander>
                                        <!-- This is for Reactions display and whether they are is in cytoplasm or membrane -->
                                        <Expander ExpandDirection="Down" Padding="6"
                                            IsExpanded="False"
                                            Header="Reactions"
                                            x:Name="ReactionExpander"
                                            Margin="0,-4,0,0" 
                                            Canvas.ZIndex="1"
                                            >
                                            <Grid>
                                                <Grid.Resources>
                                                    <DataTemplate x:Key="col2ListItemTemplate">
                                                        <CheckBox HorizontalAlignment="Center" IsChecked="{Binding Path=InCytosol}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="col3ListItemTemplate">
                                                        <CheckBox HorizontalContentAlignment="Center" IsChecked="{Binding Path=InMembrane}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="reacInfoDetailsTemplate">
                                                        <ListView Grid.Row="1" x:Name="lbMols" AlternationCount="2" ItemsSource="{Binding CellMolPops}">
                                                            <ListView.View>
                                                                <GridView x:Name="gvMols" >
                                                                    <GridViewColumn Width="Auto" Header="Name" DisplayMemberBinding="{Binding Name}"  />
                                                                    <GridViewColumn Width="Auto" Header="Cytosol" CellTemplate="{Binding Source={StaticResource col2ListItemTemplate}}"  />
                                                                    <GridViewColumn Width="Auto" Header="Membrane" CellTemplate="{Binding Source={StaticResource col3ListItemTemplate}}"   />
                                                                </GridView>
                                                            </ListView.View>
                                                        </ListView>
                                                    </DataTemplate>
                                                </Grid.Resources>

                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition MinHeight="170" Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition MaxWidth="250" />
                                                </Grid.ColumnDefinitions>

                                                <ContentControl Grid.Row="1" Name="reacInfo"
                                                Content="{Binding ElementName=CellSetsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource reacInfoDetailsTemplate}" 
                                                Margin="6"/>
                                            </Grid>
                                        </Expander>
                                        <!-- This is for Reaction Complexes and whether they are is in cytoplasm or membrane -->
                                        <Expander ExpandDirection="Down" Padding="6"
                                            IsExpanded="False"
                                            Header="Reaction Complexes"
                                            x:Name="ReactionComplexExpander"
                                            Margin="0,-4,0,0" 
                                            Canvas.ZIndex="1"
                                            >
                                            <Grid>
                                                <Grid.Resources>
                                                    <DataTemplate x:Key="col2ListItemTemplate">
                                                        <CheckBox HorizontalAlignment="Center" IsChecked="{Binding Path=InCytosol}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="col3ListItemTemplate">
                                                        <CheckBox HorizontalContentAlignment="Center" IsChecked="{Binding Path=InMembrane}" />
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="reacCxInfoDetailsTemplate">
                                                        <ListView Grid.Row="1" x:Name="lbMols" AlternationCount="2" ItemsSource="{Binding CellMolPops}">
                                                            <ListView.View>
                                                                <GridView x:Name="gvMols" >
                                                                    <GridViewColumn Width="Auto" Header="Name" DisplayMemberBinding="{Binding Name}"  />
                                                                    <GridViewColumn Width="Auto" Header="Cytosol" CellTemplate="{Binding Source={StaticResource col2ListItemTemplate}}"  />
                                                                    <GridViewColumn Width="Auto" Header="Membrane" CellTemplate="{Binding Source={StaticResource col3ListItemTemplate}}"   />
                                                                </GridView>
                                                            </ListView.View>
                                                        </ListView>
                                                    </DataTemplate>
                                                </Grid.Resources>

                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition MinHeight="170" Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition MaxWidth="250" />
                                                </Grid.ColumnDefinitions>

                                                <ContentControl Grid.Row="1" Name="reacComplexInfo"
                                                Content="{Binding ElementName=CellSetsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource reacCxInfoDetailsTemplate}" 
                                                Margin="6"/>
                                            </Grid>
                                        </Expander>
                                    </StackPanel>
                                </StackPanel>
                        </Expander>
                        </StackPanel>
                    </Expander>
                    
                    <!-- ********************************************* -->

                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- REPOSITORY -->
        <TabItem Header="Chemokines">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="8">

                    <!-- Gaussian Specifications -->
                    <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              >
                        <Expander.Header>
                            <TextBlock FontWeight="Bold" Text="Distribution Parameters" />
                        </Expander.Header>
                        <StackPanel Orientation="Vertical">
                            <ListBox x:Name="GaussianSpecsListBox" MinHeight="50" 
                                             ItemsSource="{Binding Path=entity_repository.gaussian_specifications}" 
                                             ItemTemplate="{Binding Source={StaticResource gaussianSpecListItemTemplate}}"
                                                 SelectedIndex="0"
                                             />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Name="AddGaussSpecButton"  Width="50" Content="Add" Click="AddGaussSpecButton_Click" />
                                <Button Name="RemoveGaussSpecButton" Width="50" Content="Remove" Click="RemoveGaussSpecButton_Click" />
                            </StackPanel>
                            <ContentControl Name="GaussSpecDetails"
                                                Content="{Binding ElementName=GaussianSpecsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource gaussianSpecDetailsTemplate}" 
                                                Margin="8"/>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- GLOBAL PARAMETERS -->
        <TabItem Header="Behaviors">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="8">

                    <!-- Parameter Types -->
                    <TextBlock Text="Global Parameters" FontWeight="Bold" Margin="0,5,0,0" />
                    <ListBox x:Name="GlobalParameterTypesListBox" MinHeight="50" 
                                             ItemsSource="{Binding Path=global_parameters}" 
                                             ItemTemplate="{Binding Source={StaticResource globalParamterTypeListItemTemplate}}"
                                             SelectedIndex="0"
                                             />
                    <ContentControl Name="GlobalParameterTypeDetails"
                                            Content="{Binding ElementName=GlobalParameterTypesListBox, Path=SelectedItem}" 
                                            ContentTemplate="{StaticResource globalParameterTypeDetailsTemplate}" 
                                            Margin="8"/>

                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- MOLECULES AND REACTIONS/DIFFERENTIATION SCHEMES -->
        <TabItem Header="Molecules and Reactions Libraries">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <Expander                                            
                            Padding="10" ExpandDirection="Down"
                            IsExpanded="False"
                            Header="Molecules"                                                  
                            x:Name="MoleculesExpander"
                            Margin="0,2,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                                >

                        <Grid>
                            <Grid.Resources>
                                <DataTemplate x:Key="molPopListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" />

                                    </StackPanel>
                                </DataTemplate>

                                <DataTemplate x:Key="predefMolListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" Margin="5,0,0,0"/>
                                    </StackPanel>
                                </DataTemplate>

                            </Grid.Resources>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="32" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />

                            </Grid.RowDefinitions>

                            <!-- MOLECULES -->
                            <TextBlock Text="Molecules" Grid.Column="0" Grid.Row="0" Margin="0,-6" FontWeight="Bold"  />
                            <ListBox x:Name="lbMol" Visibility="Visible" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" AlternationCount="2"                                                     
                                    ItemsSource="{Binding Path=PredefMolecules}" 
                                    DisplayMemberPath="Name"
                                    SelectedIndex="0" />

                            <Button x:Name="btnAddMolec" Grid.Column="1" Grid.Row="2" Width="80" Height="32" HorizontalAlignment="Right" Click="btnAddMolec_Click">Add</Button>
                            <Button x:Name="btnRemoveMolec" Grid.Column="2" Grid.Row="2" Width="80" Height="32" HorizontalAlignment="Left" >Remove</Button>

                            <StackPanel Grid.Column="0" Grid.Row="3" Grid.ColumnSpan="3" Margin="0,8" Orientation="Vertical" DataContext="{Binding ElementName=lbMol, Path=SelectedItem}" >
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <!-- Name -->
                                    <TextBlock Text="Molecule Name" Margin="6,0" Grid.Column="0" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtMolName" Text="{Binding Path=Name}" Grid.Column="1" Grid.Row="0"  Height="24" Margin="0,4" IsReadOnly="True"  ></TextBox>
                                    <!-- Weight -->
                                    <TextBlock Text="Molecular Weight" Margin="6,0" Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtMolWt" Grid.Column="1" Grid.Row="1" Text="{Binding Path=MolecularWeight, Mode=TwoWay}" Width="80" Height="24" Margin="0,4"></TextBox>
                                    <!-- Radius -->
                                    <TextBlock Text="Molecular Radius"  Grid.Column="0" Grid.Row="2" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" />
                                    <TextBox x:Name="txtRadius" Grid.Column="1" Grid.Row="2" Text="{Binding Path=EffectiveRadius}" Width="80" Height="24" Margin="0,4" />

                                </Grid>
                                
                            </StackPanel>

                        </Grid>
                    </Expander>
                    <Expander
                                            Padding="10" 
                                            ExpandDirection="Down"
                                            IsExpanded="False"
                                            Header="Reactions"                                              
                                            x:Name="ReactionsExpander"
                                            Margin="0,10,0,0" 
                                            Canvas.ZIndex="1"
                                            BorderThickness="1"
                                            BorderBrush="Black"
                                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                                            >

                        <Grid >
                            <Grid.Resources>
                                <DataTemplate x:Key="reactionListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=TotalReactionString}" />
                                    </StackPanel>
                                </DataTemplate>

                            </Grid.Resources>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="130" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="24" />
                                <RowDefinition Height="150" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="12" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="32" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- REACTIONS -->
                            <TextBlock Text="Reactions" Grid.Column="0" Grid.Row="0"  FontWeight="Bold"  Margin="0,0,0,0" />
                            <ListBox x:Name="lbReactions" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" Margin="0,0,0,0" AlternationCount="2"                                                        
                                                            ItemsSource="{Binding Path=PredefReactions, Mode=TwoWay}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource reactionListItemTemplate}}"
                                                            SelectedIndex="0"
                                                            >
                            </ListBox>
                            <Button x:Name="btnAddReaction" Grid.Column="1" Grid.Row="2" Width="50" HorizontalAlignment="Right" >Add</Button>
                            <Button x:Name="btnRemoveReaction" Grid.Column="2" Grid.Row="2" Width="100" HorizontalAlignment="Left">Remove</Button>

                            <!-- Left Side -->
                            <TextBlock Text="Reactants" Grid.Column="0" Grid.Row="4" FontWeight="Bold" Margin="0,0,0,0" />
                            <!--<TextBox x:Name="txtLeftSide" Width="192" Height="32" Grid.Column="0" Grid.Row="5" HorizontalAlignment="Left" Margin="0,10,0,0"></TextBox>-->
                            <TextBox x:Name="txtLeftSide" Text="{Binding Path=ReactantsString, Mode=OneWay}" Width="192" Height="32" Grid.Column="0" Grid.Row="5" HorizontalAlignment="Left" Margin="0,0,0,0"></TextBox>

                            <!-- Right Arrow -->
                            <TextBlock Text="->" Grid.Column="1" Grid.Row="5" Margin="0,0,0,0" HorizontalAlignment="Center"></TextBlock>

                            <!-- Right Side -->
                            <TextBlock Text="Products" Grid.Column="2" Grid.Row="4" FontWeight="Bold" Margin="0,0,0,0" />
                            <!--<TextBox x:Name="txtRightSide" Width="200" Height="32" Grid.Column="2" Grid.Row="5" Margin="0,10,0,0"></TextBox>-->
                            <TextBox x:Name="txtRightSide" Text="{Binding Path=ProductsString, Mode=OneWay}" Width="200" Height="32" Grid.Column="2" Grid.Row="5" Margin="0,0,0,0"></TextBox>

                            <!-- Rate Constant -->
                            <TextBlock Text="Rate Constant (k)" Grid.Column="0" Grid.Row="6" FontWeight="Bold" Margin="0,10,0,0" />
                            <!--<TextBox x:Name="txtRateConstant" Width="100" Height="32" Grid.Column="0" Grid.Row="7" HorizontalAlignment="Left" Margin="0,10,0,0"></TextBox>-->
                            <TextBox x:Name="txtRateConstant" Text="{Binding Path=RateConst}" Width="100" Height="24" Grid.Column="0" Grid.Row="7" HorizontalAlignment="Left" Margin="0,0,0,0"></TextBox>

                            <Expander 
                                                    Padding="10" ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Add Reaction"                                                  
                                                    x:Name="AddReaction"
                                                    Margin="0,10,0,0" 
                                                    Canvas.ZIndex="1"
                                                    BorderThickness="1"
                                                    BorderBrush="Black"
                                                    Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"                                                        
                                                    Width="580"
                                                    Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="5">
                                <Grid>
                                    <local:AddReactionControl />
                                </Grid>
                            </Expander>
                        </Grid>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- REACTION COMPLEXES -->
        <TabItem Header="Reaction Complexes/Differentiation Schemes">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <Expander
                        Padding="5" 
                        ExpandDirection="Down"
                        IsExpanded="False"
                        Header="Reaction Complexes"                           
                        x:Name="ReacComplexExpander"
                        Margin="0,5,0,0" 
                        Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <!-- REACTION COMPLEXES -->
                        <Expander.Resources>
                            <Style  TargetType="{x:Type ListBoxItem}">
                                <Style.Triggers>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                                        <Setter Property="Background" Value="White"></Setter>
                                    </Trigger>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="Beige"></Setter>
                                        <Setter Property="BorderBrush" Value="Black" />
                                        <Setter Property="BorderThickness" Value="1" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Expander.Resources>
                        <StackPanel>
                            <StackPanel.Resources>
                                <DataTemplate x:Key="reacComplexListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" Foreground="Red" />
                                    </StackPanel>
                                </DataTemplate>
                            </StackPanel.Resources>
                            
                            <StackPanel>                                
                                
                                <TextBlock Text="Reaction Complexes" Grid.Column="0" Grid.Row="0" Margin="0,0,0,0" />
                                <ListBox x:Name="lbComplexes" MinHeight="50"
                                            ItemsSource="{Binding Path=PredefReactionComplexes}"                                                      
                                            ItemTemplate="{Binding Source={StaticResource reacComplexListItemTemplate}}"
                                            SelectedIndex="0">
                                </ListBox>
                            </StackPanel>

                            <StackPanel DataContext="{Binding ElementName=lbComplexes, Path=SelectedItem}" Orientation="Horizontal" HorizontalAlignment="Right"  Canvas.ZIndex="10">
                                <TextBlock Text="Name" HorizontalAlignment="Left" Margin="0,2"/>
                                <TextBox x:Name="txtCxName" Width="150" HorizontalAlignment="Left" Text="{Binding Path=Name}" ></TextBox>
                                <Button x:Name="btnEditComplex" Width="50" Click="btnEditComplex_Click">Edit</Button>
                                <Button x:Name="btnAddComplex" Width="50" Click="btnAddComplex_Click">Add</Button>
                                <Button x:Name="btnRemoveComplex" Width="60" Click="btnRemoveComplex_Click">Remove</Button>
                            </StackPanel>

                            <!-- List of Reactions in selected Reaction Complex -->
                            <StackPanel DataContext="{Binding ElementName=lbComplexes, Path=SelectedItem}" >
                                <TextBlock Text="Reactions" />
                                <ListBox x:Name="lbReactions2" MinHeight="50" AlternationCount="2"
                                    ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                    DisplayMemberPath="TotalReactionString" >
                                </ListBox>
                                <Button x:Name="btnGraphComplex" Grid.Column="4" Grid.Row="3" Grid.ColumnSpan="2" Width="140" HorizontalAlignment="Right" Click="btnGraphComplex_Click">Run Reaction Complex</Button>
                            </StackPanel>
                        </StackPanel>
                    </Expander>

                    <Expander                                            
                        Padding="5" ExpandDirection="Down"
                        IsExpanded="False"
                        Header="Differentiation Schemes"                                                  
                        x:Name="DiffSchemeExpander"
                        Margin="0,10,0,0" 
                        Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel Orientation="Vertical" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.CanContentScroll="True">
                            <Grid DataContext="{Binding ElementName=lbDiff, Path=SelectedItem}">
                                <Grid.Resources>
                                    <DataTemplate x:Key="diffSchemeListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="geneListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="50" Text="{Binding Path=Name}" />
                                            <CheckBox IsChecked="{Binding Path=Active}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="stateListItemTemplate">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock VerticalAlignment="Top" Text="{Binding Path=Name}" />
                                            <ListBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" 
                                                ItemsSource="{Binding Path=Genes}" DisplayMemberPath="Active" 
                                                ItemTemplate="{Binding Source={StaticResource geneListItemTemplate}}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="cellState2ListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="20" Text="{Binding Path=Name}" />
                                            <TextBlock Width="10" Text="" />
                                            <TextBox Width="50" Text="{Binding Path=MolName}" />
                                            <!--<ComboBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" 
                                                                        ItemsSource="{Binding Path=molecNames}" 
                                                                        />-->
                                        </StackPanel>
                                    </DataTemplate>
                                    <DataTemplate x:Key="cellStateListItemTemplate">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock VerticalAlignment="Top" Text="{Binding Path=Name}" />
                                            <ListBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" ItemsSource="{Binding Path=CellStates}" DisplayMemberPath="Active" 
                                                                    ItemTemplate="{Binding Source={StaticResource cellState2ListItemTemplate}}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="diffStatesListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="80" Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="cellStateGridItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="80" Text="{Binding Path=MolName}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </Grid.Resources>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200" />
                                    <ColumnDefinition Width="130" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="120" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>

                                <!-- DIFFERENTIATION SCHEMES -->
                                <!--<TextBlock Text="Differentiation Schemes" Grid.Column="0" Grid.Row="0"  FontWeight="Bold"  Margin="0,10,0,0" />-->
                                <ListBox x:Name="lbDiff" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Height="100" Margin="0,10,0,0" 
                                                            ItemsSource="{Binding Path=ListDiffSchemes}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource diffSchemeListItemTemplate}}"
                                                            SelectedIndex="0" >
                                </ListBox>
                                <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                    <TextBlock Text="Name"  Width="50" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />
                                    <TextBox x:Name="txtDiffName" Text="{Binding Path=Name}"  Width="200" Height="24"  Margin="0,10,0,0"  ></TextBox>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button x:Name="btnEditDiff" Grid.Column="1" Grid.Row="1" Width="40" HorizontalAlignment="Left" >Edit</Button>
                                    <Button x:Name="btnAddDiff" Width="40" HorizontalAlignment="Right" >Add</Button>
                                    <Button x:Name="btnCopyDiff" Width="50" HorizontalAlignment="Left" >Copy</Button>
                                    <Button x:Name="btnRemoveDiff" Width="60" HorizontalAlignment="Right" >Remove</Button>
                                </StackPanel>

                                <TextBlock Text="Epigenetic Map" Grid.Column="0" Grid.Row="2" Width="120" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />

                                <!-- Differentiation Matrix for selected Differentiation Scheme-->
                                <DataGrid Visibility="Hidden" x:Name="dgDiffScheme"  Height="100" Grid.Column="0" Grid.Row="7" Grid.ColumnSpan="2" Margin="0,10,0,0" AlternatingRowBackground="Beige"
                                                                ItemsSource="{Binding Path=CellStates}" DisplayMemberPath="MolName">

                                    <DataGrid.ColumnHeaderStyle>
                                        <Style  TargetType="DataGridColumnHeader" >
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="Background" Value="Beige" />
                                            <Setter Property="BorderBrush" Value="Black" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Setter Property="MinWidth" Value="50" />
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="ContentTemplate" >
                                                <Setter.Value>
                                                    <DataTemplate >
                                                        <StackPanel>
                                                            <TextBlock Text="Header" />
                                                            <!--<TextBlock Text="{Binding}" />-->
                                                            <!--<TextBlock Text="{Binding Path=Name}"/>-->
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>
                                    <DataGrid.RowHeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                        AncestorType={x:Type DataGridRow}}, 
                                                                        Path=Item.Name}"/>
                                        </DataTemplate>
                                    </DataGrid.RowHeaderTemplate>

                                </DataGrid>

                                <StackPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="5">
                                    <!-- This datagrid is the best one so far -->
                                    <DataGrid Margin="0,10,0,0" x:Name="TheGrid" Width="350"
                                                            AutoGenerateColumns="False"
                                                            IsReadOnly="False"
                                                            CanUserAddRows="False" 
                                                                AlternatingRowBackground="Beige"
                                                            >

                                        <DataGrid.RowHeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                    AncestorType={x:Type DataGridRow}}, 
                                                                    Path=Item.Name}"/>
                                            </DataTemplate>
                                        </DataGrid.RowHeaderTemplate>

                                    </DataGrid>
                                    <ListBox Visibility="Hidden"  Height="144" HorizontalAlignment="Left" Margin="0,10,0,0" Name="lbScheme" VerticalAlignment="Top" Width="250" VerticalContentAlignment="Top" 
                                                                ItemsSource="{Binding Path=States}"
                                                                ItemTemplate="{Binding Source={StaticResource stateListItemTemplate}}">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                    </ListBox>
                                </StackPanel>

                                <TextBlock Text="Differentiation Regulators" Grid.Column="0" Grid.Row="5" Width="150" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />
                                <StackPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="6" Grid.ColumnSpan="5">

                                    <!-- This CellState datagrid is good -->
                                    <DataGrid Height="144" Width="350" Margin="0,10,0,0" x:Name="CellStateGrid" 
                                                                AutoGenerateColumns="False"
                                                                IsReadOnly="False"
                                                                CanUserAddRows="False" >
                                                                        <!--SelectedCellsChanged="CellStateGrid_SelectedCellsChanged"-->
                                                                
                                        <DataGrid.Resources>
                                            <Style x:Name="MyStyle" TargetType="ComboBox">
                                                <Setter Property="IsEnabled" Value="True" />
                                                <Setter Property="Visibility" Value="Visible" />
                                            </Style>
                                        </DataGrid.Resources>
                                        <DataGrid.RowHeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                        AncestorType={x:Type DataGridRow}}, 
                                                                        Path=Item.Name}"/>
                                            </DataTemplate>
                                        </DataGrid.RowHeaderTemplate>

                                    </DataGrid>
                                    <ListBox Visibility="Hidden" Height="144" HorizontalAlignment="Left" Margin="0,10,0,0" Name="lbCellStates" VerticalAlignment="Top" Width="250" VerticalContentAlignment="Top" 
                                                                ItemsSource="{Binding Path=CellStates}"
                                                                ItemTemplate="{Binding Source={StaticResource cellStateListItemTemplate}}">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                    </ListBox>
                                    <!--<Button x:Name="btnDebug1" Height="24" Width="40" HorizontalAlignment="Left" Click="btnDebug1_Click">Debug</Button>-->
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>



    </TabControl>
</docking:ToolWindow>
