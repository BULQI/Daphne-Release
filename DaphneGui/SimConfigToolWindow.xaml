<docking:ToolWindow x:Class="DaphneGui.SimConfigToolWindow"
                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:sys="clr-namespace:System;assembly=mscorlib"
                    xmlns:local="clr-namespace:DaphneGui"
                    xmlns:daph="clr-namespace:Daphne;assembly=Daphne"
                    xmlns:shared="http://schemas.actiprosoftware.com/winfx/xaml/shared"
                    xmlns:editors="http://schemas.actiprosoftware.com/winfx/xaml/editors"
                    xmlns:docking="http://schemas.actiprosoftware.com/winfx/xaml/docking"
                    ImageSource="Images/Properties16.png"
                    >
    
    <!-- xmlns:daph="clr-namespace:Daphne"-->

    <TabControl x:Name="ConfigTabControl" Grid.Column="0" TabStripPlacement="Bottom">
        <TabControl.Resources>
            <!-- For changing color of alternating rows of ListBox -->
            <Style  TargetType="{x:Type ListBoxItem}">
                <Style.Triggers>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                        <Setter Property="Background" Value="White"></Setter>
                    </Trigger>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                        <Setter Property="Background" Value="Beige"></Setter>
                        <Setter Property="BorderBrush" Value="Black" />
                        <Setter Property="BorderThickness" Value="1" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <daph:RelativePositionToShortStringConverter x:Key="RelativePosEnumConv" />            
            <daph:MolPopDistributionTypeToStringConverter x:Key="MolPopDistTypeEnumConv" />
            <daph:CellPopDistributionTypeToStringConverter x:Key="CellPopDistTypeEnumConv" />
            <daph:SWMColorToSolidBrushConverter x:Key="colorToSolidBrushConv" />
            <daph:RegionGUIDtoNameConverter x:Key="RegionGUIDtoNameConv" />
            <daph:ManyToBooleanConverter x:Key="ManyConv" />
            <daph:TextToColorConverter x:Key="textToColorConv" />
            <daph:MolGUIDtoMolNameConverter x:Key="MolGUIDtoMolNameConv" />
            <daph:ReacGUIDtoReacStringConverter x:Key="ReacGUIDtoReacStringConv" />

            <!--<daph:GlobalParamTypeToStringConverter x:Key="GlobalParameterTypeEnumConv" />-->
            <!--<daph:CellTypeGUIDtoNameConverter x:Key="CellTypeGUIDtoNameConv" />-->
            <!--<daph:SolfacGUIDtoSolfacNameConverter x:Key="SolfacGUIDtoSolfacNameConv" />-->
            <!--<daph:SolfacGUIDtoReceptorNameConverter x:Key="SolfacGUIDtoReceptorNameConv" />-->

                <!--<ObjectDataProvider x:Key="molPopPosition"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:MolPopPosition" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>-->

            <ObjectDataProvider x:Key="regionShapesEnum"
                            MethodName="GetValues" 
                            ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:RegionShape" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="relativePosition"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:RelativePosition" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="molpopDistributionTypes"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:MolPopDistributionType" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="cellPopDistributionTypes"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:CellPopDistributionType" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <ObjectDataProvider x:Key="cellPopProbDistributionTypes"
                    MethodName="GetValues" 
                    ObjectType="{x:Type sys:Enum}">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="daph:CellPopProbDistributionType" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>

            <CollectionViewSource x:Key="cellsetRegionsListView"  
                                  Source="{Binding Path=scenario.regions}"/>

            <CollectionViewSource x:Key="boxSpecsListView"  
                                  Source="{Binding Path=entity_repository.box_specifications}"/>

            <CollectionViewSource x:Key="ggBoxSpecsListView"  
                                  Source="{Binding Path=entity_repository.box_specifications}"/>

            <CollectionViewSource x:Key="solfacGaussianSpecsListView"  
                                  Source="{Binding Path=entity_repository.gaussian_specifications}"/>

            <CollectionViewSource x:Key="solfacSolfacTypesListView"  
                                  Source="{Binding Path=entity_repository.solfac_types}"/>

            <CollectionViewSource x:Key="cellTypesListView"  
                                  Source="{Binding Path=entity_repository.cells}"/>
            <CollectionViewSource x:Key="moleculesListView"  
                                  Source="{Binding Path=entity_repository.molecules}"/>
            <CollectionViewSource x:Key="reactionsListView"  
                                  Source="{Binding Path=entity_repository.reactions}"/>

            <!-- skg 5/29/12 -->
            <CollectionViewSource x:Key="baseCellTypesListView"  
                                  Source="{Binding Path=entity_repository.CellBaseTypeLabel}"/>
            <!-- Style for visibility checkboxes in list views -->
            <Style x:Key="EyeballCheckboxStyle" TargetType="CheckBox">
                <Setter Property="SnapsToDevicePixels" Value="true"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type CheckBox}">
                            <Grid Width="13" Height="13">
                                <Image x:Name="_image" Source="Images/cartoonEyeClosed.png" Opacity="0.6"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="_image" Property="Source" Value="Images/cartoonEyeOpen.png"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="_image" Property="Opacity" Value="0.2" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!-- skg 7/26/12-->
            <sys:Int32 x:Key="ToolTipInitialShowDelay">100</sys:Int32>
            <Style TargetType="TextBlock">
                <Setter Property="ToolTipService.InitialShowDelay" Value="{StaticResource ToolTipInitialShowDelay}"/>
            </Style>
            
            <!-- skg Monday, April 29, 2013 -->
            <Style x:Key="ExpanderHeaderFocusVisual">
                <Setter Property="Control.Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <Border>
                                <Rectangle SnapsToDevicePixels="true"
                           Margin="0"
                           Stroke="Black"
                           StrokeDashArray="1 2"
                           StrokeThickness="1" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="ExpanderDownHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderRightHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Top"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderUpHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ExpanderLeftHeaderStyle"
       TargetType="{x:Type ToggleButton}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Padding="{TemplateBinding Padding}">
                                <Grid SnapsToDevicePixels="False"
                          Background="Transparent">
                                    <ContentPresenter SnapsToDevicePixels="True"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Top"
                                          RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ArrowlessExpanderTemplate"
       TargetType="{x:Type Expander}">
                <Setter Property="Foreground"
            Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
                <Setter Property="Background"
            Value="Transparent" />
                <Setter Property="HorizontalContentAlignment"
            Value="Stretch" />
                <Setter Property="VerticalContentAlignment"
            Value="Stretch" />
                <Setter Property="BorderBrush"
            Value="Transparent" />
                <Setter Property="BorderThickness"
            Value="1" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Expander}">
                            <Border SnapsToDevicePixels="true"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="3">
                                <DockPanel>
                                    <ToggleButton FontFamily="{TemplateBinding FontFamily}"
                                      FontSize="{TemplateBinding FontSize}"
                                      FontStretch="{TemplateBinding FontStretch}"
                                      FontStyle="{TemplateBinding FontStyle}"
                                      FontWeight="{TemplateBinding FontWeight}"
                                      Foreground="{TemplateBinding Foreground}"
                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                      Padding="{TemplateBinding Padding}"
                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                      FocusVisualStyle="{StaticResource ExpanderHeaderFocusVisual}"
                                      Margin="1"
                                      MinHeight="0"
                                      MinWidth="0"
                                      x:Name="HeaderSite"
                                      Style="{StaticResource ExpanderDownHeaderStyle}"
                                      Content="{TemplateBinding Header}"
                                      ContentTemplate="{TemplateBinding HeaderTemplate}"
                                      ContentTemplateSelector="{TemplateBinding HeaderTemplateSelector}"
                                      DockPanel.Dock="Top"
                                      IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" />
                                    <ContentPresenter Focusable="false"
                                          Visibility="Collapsed"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          Margin="{TemplateBinding Padding}"
                                          x:Name="ExpandSite"
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                          DockPanel.Dock="Bottom" />
                                </DockPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsExpanded"
                             Value="true">
                                    <Setter Property="Visibility"
                                TargetName="ExpandSite"
                                Value="Visible" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Right">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Right" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Left" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderRightHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Up">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Top" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Bottom" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderUpHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="ExpandDirection"
                             Value="Left">
                                    <Setter Property="DockPanel.Dock"
                                TargetName="ExpandSite"
                                Value="Left" />
                                    <Setter Property="DockPanel.Dock"
                                TargetName="HeaderSite"
                                Value="Right" />
                                    <Setter Property="Style"
                                TargetName="HeaderSite"
                                Value="{StaticResource ExpanderLeftHeaderStyle}" />
                                </Trigger>
                                <Trigger Property="IsEnabled"
                             Value="false">
                                    <Setter Property="Foreground"
                                Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- =========================== -->
            <!-- Box Specification -->
            <DataTemplate x:Key="boxSpecDetailsTemplate">
                <Grid Margin="0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Grid.Column="0" Grid.Row="0"
                          VerticalAlignment="Center">
                        <Rectangle Fill="White"
                                   Stroke="Black"
                                   StrokeThickness="0.5"
                                   Width="15"
                                   Height="15"
                                   />
                        <CheckBox x:Name="box_widget_on_checkbox"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                    Style="{StaticResource EyeballCheckboxStyle}"
                                    IsChecked="{Binding Path=box_visibility}"
                                    />
                    </Grid>
                    <TextBlock Text="center (µm)" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Margin="5,4" HorizontalAlignment="Right"/>
                    <TextBlock Text="size (µm)" Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="0" Margin="3,4" HorizontalAlignment="Right"/>
                    <!--<Line Margin="4,0,4,3" 
                          Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />
                    <Line Margin="4,0,4,3" 
                          Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />-->
                    <TextBlock Text="X" Grid.Column="0" Grid.Row="2" Margin="2,0" TextAlignment="Right"/>
                    <Slider x:Name="x_trans_slider"
                            Grid.Column="1" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_trans_min}" 
                            Maximum="{Binding Path=x_trans_max}"
                            Value="{Binding Path=x_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="x_scale_slider"
                            Grid.Column="3" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_scale_min}" 
                            Maximum="{Binding Path=x_scale_max}"
                            Value="{Binding Path=x_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Y" Grid.Column="0" Grid.Row="3" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="y_trans_slider"
                            Grid.Column="1" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_trans_min}" 
                            Maximum="{Binding Path=y_trans_max}"
                            Value="{Binding Path=y_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="y_scale_slider"
                            Grid.Column="3" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_scale_min}" 
                            Maximum="{Binding Path=y_scale_max}"
                            Value="{Binding Path=y_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Z" Grid.Column="0" Grid.Row="4" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="z_trans_slider"
                            Grid.Column="1" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_trans_min}" 
                            Maximum="{Binding Path=z_trans_max}"
                            Value="{Binding Path=z_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="z_scale_slider"
                            Grid.Column="3" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_scale_min}" 
                            Maximum="{Binding Path=z_scale_max}"
                            Value="{Binding Path=z_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Minimum="1"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                </Grid>
            </DataTemplate>

            <!-- Gaussian Box Specification -->
            <DataTemplate x:Key="gaussBoxSpecDetailsTemplate">
                <Grid Margin="0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Grid.Column="0" Grid.Row="0"
                          VerticalAlignment="Center">
                        <Rectangle Fill="White"
                                   Stroke="Black"
                                   StrokeThickness="0.5"
                                   Width="15"
                                   Height="15"
                                   />
                        <CheckBox x:Name="box_widget_on_checkbox"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                    Style="{StaticResource EyeballCheckboxStyle}"
                                    IsChecked="{Binding Path=box_visibility}"
                                    />
                    </Grid>
                    <TextBlock Text="center (µm)" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Margin="5,4" HorizontalAlignment="Right"/>
                    <TextBlock Text="width (µm)" Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="0" Margin="3,4" HorizontalAlignment="Right"/>
                    <!--<Line Margin="4,0,4,3" 
                          Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />
                    <Line Margin="4,0,4,3" 
                          Grid.Column="3" Grid.ColumnSpan="2" Grid.Row="1" 
                          SnapsToDevicePixels="True" Stroke="LightGray"
                          Stretch="Fill" X1="0" X2="10" />-->
                    <TextBlock Text="X" Grid.Column="0" Grid.Row="2" Margin="2,0" TextAlignment="Right"/>
                    <Slider x:Name="x_trans_slider"
                            Grid.Column="1" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_trans_min}" 
                            Maximum="{Binding Path=x_trans_max}"
                            Value="{Binding Path=x_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="x_scale_slider"
                            Grid.Column="3" Grid.Row="2"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=x_scale_min}" 
                            Maximum="{Binding Path=x_scale_max}"
                            Value="{Binding Path=x_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="2"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=x_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Y" Grid.Column="0" Grid.Row="3" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="y_trans_slider"
                            Grid.Column="1" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_trans_min}" 
                            Maximum="{Binding Path=y_trans_max}"
                            Value="{Binding Path=y_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="y_scale_slider"
                            Grid.Column="3" Grid.Row="3"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=y_scale_min}" 
                            Maximum="{Binding Path=y_scale_max}"
                            Value="{Binding Path=y_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=y_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <TextBlock Text="Z" Grid.Column="0" Grid.Row="4" Margin="2,0" TextAlignment="Right" />
                    <Slider x:Name="z_trans_slider"
                            Grid.Column="1" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_trans_min}" 
                            Maximum="{Binding Path=z_trans_max}"
                            Value="{Binding Path=z_trans}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="2" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_trans_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                    <Slider x:Name="z_scale_slider"
                            Grid.Column="3" Grid.Row="4"
                            Orientation="Horizontal"
                            Width="60"
                            RenderTransform="1.0,0,0,0.5,0,4"
                            Minimum="{Binding Path=z_scale_min}" 
                            Maximum="{Binding Path=z_scale_max}"
                            Value="{Binding Path=z_scale}" 
                            KeyboardNavigation.IsTabStop="False"
                            />
                    <editors:DoubleEditBox Grid.Column="4" Grid.Row="4"
                                        CheckBoxVisibility="Collapsed" 
                                        SpinnerVisibility="Collapsed"
                                        HorizontalAlignment="Left"
                                        Format="G"
                                        StepValue="10"
                                        Width="50" 
                                        CenterSlotHorizontalAlignment="Right"
                                        Value="{Binding ElementName=z_scale_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                        />
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type daph:MolPopHomogeneousLevel}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="peak conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="10"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type daph:MolPopLinearGradient}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="min conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=min_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="max conc" Margin="6,0"
                               Grid.Column="0" Grid.Row="1"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="1"
                                Margin="0,2">
                        <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=max_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="direction" Margin="6,0"
                               Grid.Column="0" Grid.Row="2"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <Grid Grid.Column="1" Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="X" 
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <TextBlock Text="Y" 
                               Grid.Column="1" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <TextBlock Text="Z" 
                               Grid.Column="2" Grid.Row="0"  
                               HorizontalAlignment="Right" Margin="6,0"
                               />
                        <editors:DoubleEditBox Grid.Column="0" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=x_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <editors:DoubleEditBox Grid.Column="1" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=y_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <editors:DoubleEditBox Grid.Column="2" Grid.Row="1"
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Format="G"
                                                StepValue="0.1"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding Path=z_direction, UpdateSourceTrigger=PropertyChanged}"
                                                />
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate DataType="{x:Type daph:MolPopGaussianGradient}">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="peak conc" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <StackPanel Orientation="Horizontal"
                                    Grid.Column="1" Grid.Row="0"
                                    Margin="0,2">
                            <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                    SpinnerVisibility="Collapsed"
                                                    HorizontalAlignment="Right"
                                                    Format="G"
                                                    StepValue="10"
                                                    Width="50" 
                                                    CenterSlotHorizontalAlignment="Right"
                                                    Value="{Binding Path=peak_concentration, UpdateSourceTrigger=PropertyChanged}"
                                                    />
                            <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                        </StackPanel>
                        <TextBlock Text="gauss" Margin="6,0"
                                   Grid.Column="0" Grid.Row="1"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <ComboBox Name="gaussian_gradients_cbox"
                                                  Grid.Column="1" Grid.Row="1" 
                                                  ItemsSource="{Binding Source={StaticResource solfacGaussianSpecsListView}}" 
                                                  DisplayMemberPath="gaussian_spec_name"
                                                  SelectedValue="{Binding Path=gaussgrad_gauss_spec_guid_ref}"
                                                  SelectedValuePath="gaussian_spec_box_guid_ref"
                                                  MaxWidth="150"
                                                  />
                    </Grid>
                    <!-- ListView as level of indirection for getting to the correct BoxSpec -->
                    <ListView x:Name="solfacGaussianBoxSpecsListView"
                                              ItemsSource="{Binding Source={StaticResource ggBoxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=gaussgrad_gauss_spec_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="GaussianBoxSpecDetails"
                                                    Content="{Binding ElementName=solfacGaussianBoxSpecsListView, Path=SelectedItem}" 
                                                    HorizontalAlignment="Center"
                                                    ContentTemplate="{StaticResource gaussBoxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="molpopDistributionDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <ContentControl Name="solfac_dist_cc"
                                    Grid.ColumnSpan="2" Grid.Row="0"
                                    Margin="0,6"
                                    BorderBrush="DarkGray" BorderThickness="1"
                                    Content="{Binding Path=mpInfo.mp_distribution}"
                                    />
                </Grid>
            </DataTemplate>


            <!-- =========================== -->
            <!-- Mol Pops -->

            <DataTemplate x:Key="molListItemTemplate">
                <StackPanel Orientation="Horizontal">                    
                    <TextBlock Text="{Binding Path=Name}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>
            
            <!-- skg daphne -->
            <!-- Reaction -->
            <DataTemplate x:Key="reacListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=TotalReactionString}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Cell Population -->

            <!-- Cell Pop Distributions -->
            <DataTemplate x:Key="cellPopDistributionTypeTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Converter={StaticResource CellPopDistTypeEnumConv}}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate DataType="{x:Type daph:CellPopDistribution}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="dist type" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center"       />
                    <TextBox Text="{Binding Path=cpDistributionType, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,2"
                                 />
                </StackPanel>

            </DataTemplate>

            <!-- CellPopUniformDistribution -->
            <DataTemplate DataType="{x:Type daph:CellPopUniformDistribution}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="conc" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center"       />
                    <TextBox Text="{Binding Path=Conc, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,2"
                                 />
                </StackPanel>
                
            </DataTemplate>


            <DataTemplate DataType="{x:Type daph:CellPopGaussianDistribution}">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="peak conc" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <StackPanel Orientation="Horizontal"
                                    Grid.Column="1" Grid.Row="0"
                                    Margin="0,2">
                            <editors:DoubleEditBox CheckBoxVisibility="Collapsed" 
                                                    SpinnerVisibility="Collapsed"
                                                    HorizontalAlignment="Right"
                                                    Format="G"
                                                    StepValue="10"
                                                    Width="50" 
                                                    CenterSlotHorizontalAlignment="Right"
                                                    Value="{Binding Path=Peak, UpdateSourceTrigger=PropertyChanged}"
                                                    />
                            <TextBlock Text="molec/µm^3" VerticalAlignment="Center" Margin="2,0,0,0"/>
                        </StackPanel>
                        
                    </Grid>
                    <!-- ListView as level of indirection for getting to the correct BoxSpec -->
                    <ListView x:Name="solfacGaussianBoxSpecsListView"
                                              ItemsSource="{Binding Source={StaticResource ggBoxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=gaussgrad_gauss_spec_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="GaussianBoxSpecDetails"
                                                    Content="{Binding ElementName=solfacGaussianBoxSpecsListView, Path=SelectedItem}" 
                                                    HorizontalAlignment="Center"
                                                    ContentTemplate="{StaticResource gaussBoxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="cellPopListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <!--<CheckBox IsChecked="{Binding Path=cellpopulation_render_on}" Style="{StaticResource EyeballCheckboxStyle}"/>-->
                    <Rectangle Width="10" Height="10"
                                               Margin="5,0,0,0"
                                               VerticalAlignment="Center"
                                               Fill="{Binding Path=cellpopulation_color, Converter={StaticResource colorToSolidBrushConv}}"
                                               Stroke="Black" StrokeThickness="0.5"/>

                    <TextBlock Text="{Binding Path=cellpopulation_name}" Margin="5,0,0,0"/>
                    <TextBlock Text=" " />
                    <TextBlock Text="{Binding Path=number}" />
                    <TextBlock Text=" " />
                    <TextBlock Text="{Binding Path=CellType.CellName}" />
                    
                    <StackPanel Orientation="Horizontal">
                        <!-- Only want an "s" to show up if more than one cell -->
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="s" />
                    </StackPanel>

                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="cellListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <!--<CheckBox IsChecked="{Binding Path=cellpopulation_render_on}" Style="{StaticResource EyeballCheckboxStyle}"/>-->
                    <Rectangle Width="10" Height="10"
                                               Margin="5,0,0,0"
                                               VerticalAlignment="Center"
                                               Fill="{Binding Path=cellpopulation_color, Converter={StaticResource colorToSolidBrushConv}}"
                                               Stroke="Black" StrokeThickness="0.5"/>
                    <TextBlock Text="{Binding Path=number}" Margin="5,0,0,0"/>
                    <TextBlock Text=" " />
                    <!--<TextBlock Text="{Binding Path=cell_subset_guid_ref, 
                                                                Converter={StaticResource CellTypeGUIDtoNameConv}, 
                                                                ConverterParameter={StaticResource cellsetCellTypesListView}}" />-->
                    <StackPanel Orientation="Horizontal">
                        <!-- Only want an "s" to show up if more than one cell -->
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=number, Converter={StaticResource ManyConv}}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="s" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <!-- Only want a region name to show up if cells are constrained to region -->
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=cellpopulation_constrained_to_region}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=cellpopulation_constrained_to_region}" Value="False">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding Path=wrt_region, 
                                                                Converter={StaticResource RelativePosEnumConv}}" />
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding Path=cellpopulation_region_guid_ref, 
                                                                Converter={StaticResource RegionGUIDtoNameConv}, 
                                                                ConverterParameter={StaticResource cellsetRegionsListView}}" />
                    </StackPanel>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="cellPopDistributionDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />                   
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />                        
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Column="0" Grid.Row="0" Margin="20,0">Location Parameters</TextBlock>
                    <TextBox Grid.Column="0" Grid.Row="1" Margin="20,0"
                             Text="{Binding Path=Peak}">
                        
                    </TextBox>
                    <ContentControl Name="cell_dist"
                            Grid.ColumnSpan="2" Grid.Row="2"
                            Margin="0,6"
                            BorderBrush="DarkGray" BorderThickness="1"
                            Content="{Binding Path=cellPopDist}"
                            />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="cellPopDetailsTemplate">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock Text="name" Margin="6,0"
                                        Grid.Column="0" Grid.Row="0"  
                                        HorizontalAlignment="Right" VerticalAlignment="Center" />
                        <TextBox Text="{Binding Path=cellpopulation_name, UpdateSourceTrigger=PropertyChanged}"
                                        Grid.Column="1" Grid.Row="0"  Margin="0,2"   />
                        <TextBlock Text="cell type" Margin="6,0"
                                        Grid.Column="0" Grid.Row="1"  
                                        HorizontalAlignment="Right" VerticalAlignment="Center"  />
                        <ComboBox x:Name="cell_type_combo_box"
                                        Grid.Column="1" Grid.Row="1" Margin="0,2"
                                        MinWidth="80"
                                        ItemsSource="{Binding Source={StaticResource cellTypesListView}}"
                                        DisplayMemberPath="CellName"
                                        SelectedValue="{Binding Path=CellType}"
                                    />
                        <TextBlock Text="number" Margin="6,0"
                                        Grid.Column="0" Grid.Row="2"  
                                        HorizontalAlignment="Right" VerticalAlignment="Center"  />
                        <StackPanel Orientation="Horizontal"
                                    Grid.Column="1" Grid.Row="2"
                                    Margin="0,4">
                            <Slider x:Name="number_slider"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Width="100"
                                    RenderTransform="1.0,0,0,0.5,0,6"
                                    Minimum="1" 
                                    Maximum="10000" 
                                    Value="{Binding Path=number}" 
                                    IsSnapToTickEnabled="True" 
                                    TickFrequency="1" 
                                    KeyboardNavigation.IsTabStop="False"
                                    />
                            <editors:Int32EditBox CheckBoxVisibility="Collapsed" 
                                    SpinnerVisibility="Collapsed"
                                    HorizontalAlignment="Right"
                                    Format="N0"
                                    StepValue="10"
                                    Width="50" 
                                    CenterSlotHorizontalAlignment="Right"
                                    Value="{Binding ElementName=number_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                    />
                        </StackPanel>

                        <TextBlock Text="color" Margin="6,0"
                                        Grid.Column="0" Grid.Row="3"  
                                        HorizontalAlignment="Right" VerticalAlignment="Center"
                                        />
                        <editors:ColorEditBox x:Name="cellColorEditBox"
                                        Grid.Column="1" Grid.Row="3"
                                        CheckBoxVisibility="Collapsed"
                                        SpinnerVisibility="Collapsed"
                                        Width="140"
                                        HorizontalAlignment="Left" 
                                        Format="a r g b"
                                        Value="{Binding Path=cellpopulation_color}"
                                        Margin="0,2"
                                />
                    </Grid>
                    <Grid>
                        <Expander ExpandDirection="Down" Padding="6"
                                    
                                IsExpanded="False"
                                Header="Location"
                                x:Name="LocationExpander"
                                Margin="0,0,0,0" 
                                Canvas.ZIndex="1"
                                >

                            <StackPanel Orientation="Vertical">
                                <StackPanel Orientation="Vertical">
                                    <StackPanel>
                                        <RadioButton IsChecked="True" Margin="8, 4">By distribution</RadioButton>
                                        <StackPanel Orientation="Horizontal" Margin="20,0">
                                            <RadioButton IsChecked="True" Margin="4, 4">Uniform</RadioButton>
                                            <RadioButton Margin="10,4">Gaussian</RadioButton>
                                        </StackPanel>
                                        <RadioButton Margin="8, 4">By specific location</RadioButton>
                                        <StackPanel Orientation="Horizontal" Margin="20,0">
                                            <RadioButton Margin="4, 4">By coordinates</RadioButton>
                                            <RadioButton Margin="10,4">By location file</RadioButton>
                                            
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="16,0">
                                            <Expander ExpandDirection="Down" Padding="6"                                    
                                                IsExpanded="False"
                                                Header="Coordinates"
                                                x:Name="CoordinatesExpander"
                                                Margin="0,0,0,0" 
                                                Canvas.ZIndex="1"
                                                >
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock>X  </TextBlock>
                                                        <TextBox x:Name="txtCellX" Width="100"
                                                                 Text="{Binding Path=cell_locations[0].X}">
                                                            
                                                        </TextBox>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock>Y  </TextBlock>
                                                        <TextBox x:Name="txtCellY" Width="100" Text="{Binding Path=cell_locations[0].Y}"></TextBox>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock>Z  </TextBlock>
                                                        <TextBox x:Name="txtCellZ" Width="100" Text="{Binding Path=cell_locations[0].Z}"></TextBox>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Expander>

                                            <Expander ExpandDirection="Down" Padding="6"                                    
                                                IsExpanded="False"
                                                Header="File"
                                                x:Name="CoordFileExpander"
                                                Margin="40,0,0,0" 
                                                Canvas.ZIndex="1"
                                                >
                                                <StackPanel Orientation="Vertical">
                                                    <TextBox x:Name="txtFileName" Width="300">File Name</TextBox>
                                                    <Button x:Name="btnBrowseCoordFile" Width="60">Browse...</Button>
                                                </StackPanel>
                                            </Expander>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Expander>
                    </Grid>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="cellDetailsTemplate">
               
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Orientation="Vertical">
                            <StackPanel Orientation="Horizontal" Width="220">
                                <TextBlock Text="name" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" Width="80" />
                                <TextBox Text="{Binding Path=CellName, UpdateSourceTrigger=PropertyChanged}" Margin="0,2" Width="120"  />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Width="220">
                                <TextBlock Text="radius" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" Width="80" />
                                <TextBox Text="{Binding Path=CellRadius, UpdateSourceTrigger=PropertyChanged}" Margin="0,2"  Width="120" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Width="220">
                                <TextBlock Text="differentiator" Margin="6,0" Grid.Column="0" Grid.Row="2" HorizontalAlignment="Right" VerticalAlignment="Center" Width="80" />
                                <ComboBox  MinWidth="120"  />
                            </StackPanel>
                        </StackPanel>

                        <Expander                                            
                                Padding="5" ExpandDirection="Down"
                                IsExpanded="False"
                                Header="Locomotor"                                                  
                                x:Name="LocomotorExpander"
                                Grid.Column="0" Grid.Row="3"
                                Margin="-10,-10,0,0" 
                                Canvas.ZIndex="1"     
                                HorizontalAlignment="Right"
                                Width="Auto"
                                >

                            <StackPanel Orientation="Vertical" Margin="0,-10">
                                <StackPanel Orientation="Horizontal" Width="400">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="libMolListItemTemplate">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Path=Name}" 
                                                       Foreground="{Binding Path=ForegroundColor, Converter={StaticResource textToColorConv}}" 
                                                       Margin="5,0,0,0" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="driver" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" Width="120"/>
                                    <ComboBox  MinWidth="100"
                                                ItemsSource="{Binding Source={StaticResource moleculesListView}}"
                                                DisplayMemberPath="Name"
                                                />
                                </StackPanel>
                            </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="transduction constant" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" Width="120"/>
                                    <TextBox Text="{Binding Path=TransductionConstant, UpdateSourceTrigger=PropertyChanged}"  Margin="0,2" Width="100"  />
                                </StackPanel>
                            </StackPanel>
                        </Expander>
                    </StackPanel>

            </DataTemplate>

            <Style TargetType="editors:DoubleEditBox">
                <Setter Property="CheckBoxVisibility" Value="Collapsed" />
                <Setter Property="SpinnerVisibility" Value="Collapsed" />
                <Setter Property="HorizontalAlignment" Value="Left" />
                <Setter Property="Format" Value="G" />
                <Setter Property="Minimum" Value="0" />
                <Setter Property="Width" Value="60" />
                <Setter Property="CenterSlotHorizontalAlignment" Value="Right" />
            </Style>
            
            <DataTemplate x:Key="cellTypeListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=cell_subset_type.cell_subset_name}"/>
                </StackPanel>
            </DataTemplate>
            
            <DataTemplate x:Key="cellTypeReceptorItemTemplate">
                <TextBlock Text="{Binding Path=receptor_solfac_type_guid_ref, 
                        Converter={StaticResource SolfacGUIDtoReceptorNameConv}, 
                        ConverterParameter={StaticResource solfacSolfacTypesListView}}"
                        HorizontalAlignment="Left"
                               />
            </DataTemplate>

            

            <!-- =========================== -->
            <!-- Mol Pop Distributions -->            
            <DataTemplate x:Key="molpopDistributionTypeTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Converter={StaticResource MolPopDistTypeEnumConv}}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="solfacTimeAmpListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Time="/>
                    <TextBlock Text="{Binding Path=time_value}"/>
                    <TextBlock Text=", Amp="/>
                    <TextBlock Text="{Binding Path=amplitude}"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate DataType="{x:Type daph:MolPopCustomGradient}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="file name" Margin="6,0"
                               Grid.Column="0" Grid.Row="0"  
                               HorizontalAlignment="Right" VerticalAlignment="Center"
                               />
                    <StackPanel Orientation="Horizontal"
                                Grid.Column="1" Grid.Row="0"
                                Margin="0,2">
                        <TextBlock Text="{Binding Path=custom_gradient_file_name}"
                                   Width="150"
                                   Background="LightGray"
                                   VerticalAlignment="Center"
                                   Padding="4,0"
                                   />
                        <Button Content="..." VerticalAlignment="Center" HorizontalAlignment="Right" 
                                Width="25" Margin="2,0,0,0"
                                Click="SolfacCustomGradientFile_Click"
                                ToolTip="Choose a new custom chemokine gradient file"
                                />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="MolPopDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock Text="name" Margin="6,0"
                                   Grid.Column="0" Grid.Row="0"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                    <TextBox Text="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}"
                                 Grid.Column="1" Grid.Row="0"
                             Margin="0,2"
                                 />
                    
                    <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="2"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                    <editors:ColorEditBox x:Name="solfacColorEditBox"
                                          Grid.Column="1" Grid.Row="2"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=mpInfo.mp_color}"
                                          Margin="0,2"
                                          />
                    <TextBlock Text="render wt" Margin="6,0"
                               Grid.Column="0" Grid.Row="3"
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   TextAlignment="Right"
                                    />
                    <StackPanel Orientation="Horizontal" Grid.Column="1" Grid.Row="3"
                                IsEnabled="{Binding Path=mp_render_on}">
                        <Slider x:Name="solfac_weight_slider"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Width="50"
                                    RenderTransform="1.0,0,0,0.5,0,7"
                                    Minimum="0" 
                                    Maximum="5" 
                                    Value="{Binding Path=mpInfo.mp_render_blending_weight}" 
                                    IsSnapToTickEnabled="True" 
                                    TickFrequency="0.1" 
                                    />
                        <TextBlock Text="{Binding ElementName=solfac_weight_slider, Path=Value}" 
                                   VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   Margin="5,0,0,0"
                                   MinWidth="20"
                                   />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="reactionDetailsTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="rate constant" Margin="6,0"
                            Grid.Column="0" Grid.Row="0"  
                            HorizontalAlignment="Right" VerticalAlignment="Center"
                            />

                    <TextBox Margin="0,2" x:Name="txtRateConst"
                            Grid.Column="1" Grid.Row="0" 
                            Text="{Binding Path=RateConst, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                             IsReadOnly="True" />

                    <TextBlock Text="reaction type" Margin="6,0"
                            Grid.Column="0" Grid.Row="1"  
                            HorizontalAlignment="Right" VerticalAlignment="Center"
                            />

                    <TextBox Margin="0,2" x:Name="txtReactionType"
                            Grid.Column="1" Grid.Row="1"  
                                Text="{Binding Path=ReacTypeString, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                             IsReadOnly="True" />

                    
                </Grid>
            </DataTemplate>

            <!-- =========================== -->
            <!-- Gaussian Specifications -->

            <DataTemplate x:Key="gaussianSpecListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <CheckBox IsChecked="{Binding Path=gaussian_region_visibility}" Style="{StaticResource EyeballCheckboxStyle}" />
                    <Rectangle Width="10" Height="10"
                               Margin="5,0,0,0"
                               VerticalAlignment="Center"
                               Fill="{Binding Path=gaussian_spec_color, Converter={StaticResource colorToSolidBrushConv}}"
                               Stroke="Black" StrokeThickness="0.5"/>
                    <TextBlock Text="{Binding Path=gaussian_spec_name}" Margin="5,0,0,0"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="gaussianSpecDetailsTemplate">
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="name" Margin="6,0"
                                       Grid.Column="0" Grid.Row="0"  
                                       HorizontalAlignment="Right" VerticalAlignment="Center"
                                       />
                        <TextBox Text="{Binding Path=gaussian_spec_name, UpdateSourceTrigger=PropertyChanged}"
                                     Grid.Column="1" Grid.Row="0"
                                     />
                        <TextBlock Text="color" Margin="6,0"
                                   Grid.Column="0" Grid.Row="3"  
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   />
                        <editors:ColorEditBox x:Name="gaussSpecColorEditBox"
                                          Grid.Column="1" Grid.Row="3"
                                          CheckBoxVisibility="Collapsed"
                                          SpinnerVisibility="Collapsed"
                                          Width="140"
                                          HorizontalAlignment="Left" 
                                          Format="a r g b"
                                          Value="{Binding Path=gaussian_spec_color}"
                                              Margin="0,2"
                                          />
                    </Grid>
                    <ListView Name="ggBoxSpecsListView"
                                              ItemsSource="{Binding Source={StaticResource boxSpecsListView}}"
                                              DisplayMemberPath="box_guid"
                                              SelectedValue="{Binding Path=gaussian_spec_box_guid_ref, Mode=OneWay}"
                                              SelectedValuePath="box_guid"
                                              Visibility="Collapsed"
                                              />
                    <ContentControl Name="GGBoxSpecDetails"
                                                    Content="{Binding ElementName=ggBoxSpecsListView, Path=SelectedItem}" 
                                                    HorizontalAlignment="Center"
                                                    ContentTemplate="{StaticResource gaussBoxSpecDetailsTemplate}" 
                                                    Margin="0,2"/>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="reactionListItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Path=TotalReactionString}" />
                    <TextBlock Text="    " />
                    <TextBlock Text="Rate: " />
                    <TextBlock Text="{Binding Path=rate_const}" />
                </StackPanel>
            </DataTemplate>

        </TabControl.Resources>

        <!-- SIM SETUP -->        
        <TabItem Header="Sim Setup">        
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="8">

                    <!-- Experiment -->
                    <TextBlock Text="Experiment name" FontWeight="Bold" Margin="0,5,0,0" />
                    <TextBox Text="{Binding Path=experiment_name, UpdateSourceTrigger=PropertyChanged}" x:Name="experiment_name_box"/>

                    <TextBlock Text="Description" FontWeight="Bold" Margin="0,10,0,0" />
                    <TextBox Text="{Binding Path=experiment_description, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap"
                                        Height="40" MaxWidth="{Binding ElementName=experiment_name_box, Path=ActualWidth}"
                                        VerticalScrollBarVisibility="Auto"/>

                    <!-- TimeConfig -->
                    <TextBlock Text="Time configuration" FontWeight="Bold" Margin="0,10,0,0" />
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="total time" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="time_duration_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0" 
                                                Maximum="28800" 
                                                Value="{Binding Path=scenario.time_config.duration}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="10" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="TimeDurationReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="F0"
                                                              StepValue="100"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=time_duration_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="rendering interval" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="3"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="time_step_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0.1" 
                                                Maximum="10" 
                                                Value="{Binding Path=scenario.time_config.rendering_interval}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="0.1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="TimeStepReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N1"
                                                              StepValue="0.1"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=time_step_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <!--*************************************************-->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="sampling interval" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="4"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="sampling_interval_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="0" 
                                                Maximum="2000" 
                                                Value="{Binding Path=scenario.time_config.sampling_interval}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="SamplingInterval" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="50" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=sampling_interval_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="min" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="repetitions" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="5"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="120"
                                                    />
                        <Slider Name="exp_rep_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="1" 
                                                Maximum="50" 
                                                Value="{Binding Path=experiment_reps}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:Int32EditBox x:Name="ExpRepReadout" 
                                                CheckBoxVisibility="Collapsed" 
                                                SpinnerVisibility="Collapsed"
                                                HorizontalAlignment="Right"
                                                Width="50" 
                                                CenterSlotHorizontalAlignment="Right"
                                                Value="{Binding ElementName=exp_rep_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                />
                        <TextBlock Text="times" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- LIBRARIES: MOLECULES, REACTIONS, CELLS, REACTIONS COMPLEXES, AND DIFFERENTIATION SCHEMES -->
        <TabItem Header="Libraries">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <StackPanel.Resources>
                        <DataTemplate x:Key="libMolListItemTemplate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Path=Name}" 
                                                   Foreground="{Binding Path=ForegroundColor, Converter={StaticResource textToColorConv}}" 
                                                   Margin="5,0,0,0" />
                            </StackPanel>
                        </DataTemplate>

                    </StackPanel.Resources>
                    <!-- MOLECULES -->
                    <Expander                                            
                            Padding="5" ExpandDirection="Down"
                            IsExpanded="False"
                            Header="Molecules"                                                  
                            x:Name="MoleculesExpander"
                            Margin="0,2,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                                >

                        <StackPanel>
                            
                            <TextBlock Text="Molecules"  Margin="0,5" FontWeight="Bold"  />
                            <ListBox x:Name="lbMol" Visibility="Visible" AlternationCount="2"                                                     
                                    ItemsSource="{Binding Path=entity_repository.molecules}"                                     
                                    ItemTemplate="{Binding Source={StaticResource libMolListItemTemplate}}"
                                    SelectedIndex="-1"
                                    SelectionChanged="lbMol_SelectionChanged"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="btnAddMolec"  Width="50" Content="Add" Click="btnAddMolec_Click"></Button>
                                <Button Name="btnRemoveMolec" Width="50" Content="Remove"  Click="btnRemoveMolec_Click"></Button>
                            </StackPanel>

                            <StackPanel  Margin="0,0" Orientation="Vertical" DataContext="{Binding ElementName=lbMol, Path=SelectedItem}" >
                                <StackPanel.Resources>
                                    <daph:EnumBooleanConverter x:Key="enumBooleanConverter" />
                                </StackPanel.Resources>
                                    <!-- Name -->
                                    <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Molecule Name" Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtMolName" Text="{Binding Path=Name}" Height="24" Margin="0,4" ></TextBox>
                                    </StackPanel>
                                    <!-- Weight -->
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Molecular Weight" Margin="6,0"  HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtMolWt"  Text="{Binding Path=MolecularWeight, Mode=TwoWay}" Width="80" Height="24" Margin="0,4"></TextBox>
                                    </StackPanel>
                                    <!-- Radius -->
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Molecular Radius"  Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" />
                                        <TextBox x:Name="txtRadius" Text="{Binding Path=EffectiveRadius}" Width="80" Height="24" Margin="0,4" />
                                    </StackPanel>
                                    <!-- Diffusion coefficient -->
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Diffusion coefficient"  Margin="6,0" HorizontalAlignment="Right" VerticalAlignment="Center" />
                                        <TextBox x:Name="txtDiffCoeff" Text="{Binding Path=DiffusionCoefficient}" Width="80" Height="24" Margin="0,4" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <!--<RadioButton IsChecked="{Binding Path=molecule_location, Converter={StaticResource enumBooleanConverter}, ConverterParameter=Bulk}">bulk</RadioButton>-->
                                        <!--<RadioButton IsChecked="{Binding Path=molecule_location, Converter={StaticResource enumBooleanConverter}, ConverterParameter=Boundary}">boundary</RadioButton>-->
                                        <!--<CheckBox IsChecked="{Binding Path=molecule_location}">Boundary molecule</CheckBox>-->
                                    <RadioButton IsChecked="{Binding Path=molecule_location}" x:Name="rbBulk"  Margin="6,0" Click="rbBulk_Click">Bulk</RadioButton>
                                    <RadioButton IsChecked="{Binding Path=molecule_location}" x:Name="rbBoundary"  Margin="10,0" Click="rbBoundary_Click">Boundary</RadioButton>
                                        
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        
                    </Expander>
                    <!-- REACTIONS -->
                    <Expander
                                Padding="5" 
                                ExpandDirection="Down"
                                IsExpanded="False"
                                Header="Reactions"                                              
                                x:Name="ReactionsExpander"
                                Margin="0,4,0,0" 
                                Canvas.ZIndex="1"
                                BorderThickness="1"
                                BorderBrush="Black"                        
                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"                                
                                Expanded="ReactionsExpander_Expanded"
                                >

                        
                        <Grid >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="230" />
                                <ColumnDefinition Width="130" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="150" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="12" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- REACTIONS -->

                            <ListBox x:Name="lbReactions" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Margin="0,0,0,0" AlternationCount="2"                                                        
                                                        ItemsSource="{Binding Path=entity_repository.reactions, Mode=TwoWay}"                                                      
                                                        ItemTemplate="{Binding Source={StaticResource reactionListItemTemplate}}"
                                                        SelectedIndex="0"
                                                        >
                            </ListBox>
                            <Button x:Name="btnRemoveReaction" Grid.Column="2" Grid.Row="1" Width="100" HorizontalAlignment="Right" Click="btnRemoveReaction_Click">Remove</Button>
                                
                            <!--</Expander>-->


                            <Expander 
                                    Padding="10" ExpandDirection="Down"
                                    IsExpanded="False"
                                    Header="Add Reaction"                                                  
                                    x:Name="AddReaction"
                                    Margin="0,4,0,0" 
                                    Canvas.ZIndex="1"
                                    BorderThickness="1"
                                    BorderBrush="Black"
                                    Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"                                                        
                                    Width="480"
                                    Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="5"
                                    HorizontalAlignment="Left">
                                <Grid>
                                    <local:AddReactionControl />
                                </Grid>
                            </Expander>
                        </Grid>
                    </Expander>
                    
                    <!-- CELLS -->
                    <Expander ExpandDirection="Down" Padding="5"
                            IsExpanded="False"
                            Header="Cells"
                            x:Name="CellsExpander"
                            Margin="0,4,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                            >
                        <StackPanel>
                            <ListBox x:Name="CellsListBox" MinHeight="50" 
                                    ItemsSource="{Binding Path=entity_repository.cells}" 
                                    DisplayMemberPath="CellName"
                                    SelectedIndex="0"
                                    />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddCellButton"  Width="50" Content="Add" />
                                <Button Name="RemoveCellButton" Width="50" Content="Remove"  />
                            </StackPanel>

                            <Expander ExpandDirection="Down" Padding="6"
                                    IsExpanded="False"
                                    Header="Cell Details"
                                    x:Name="CellsDetailsExpander"
                                    Margin="0,-15,0,0" 
                                    Canvas.ZIndex="1"
                                      
                                    >

                                <StackPanel Orientation="Vertical">
                                    <StackPanel Orientation="Horizontal">
                                        <ContentControl Name="CellDetails"
                                                Content="{Binding ElementName=CellsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource cellDetailsTemplate}" 
                                                Margin="6,-4"/>
                                    </StackPanel>

                                    <!-- Mol Pops in this cell and their location, i.e. cytoplasm or membrane -->
                                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Cell Molecular Populations"                                              
                                                    x:Name="CellMolPopsExpander"
                                                    Margin="0,10,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                                        <!--<StackPanel>-->
                                            <!-- Molecular Populations -->
                                                                                        
                                            <StackPanel Orientation="Horizontal">
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Membrane" FontWeight="Bold" Margin="0,-10,0,0" >
                                                    </TextBlock>
                                                    <ListBox x:Name="CellMembraneMolPopsListBox" MinHeight="50" Height="100" MaxHeight="100" Width="150"
                                                             DataContext="{Binding ElementName=CellsListBox, Path=SelectedItem}"
                                                             ItemsSource="{Binding CellMolPops}" 
                                                             ItemTemplate="{Binding Source={StaticResource molListItemTemplate}}"
                                                             SelectedIndex="0"
                                                    />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                        <Button Name="MembraneAddMolButton"  Width="50" Content="Add" />
                                                        <Button Name="MembraneRemoveMolButton" Width="50" Content="Remove" />
                                                    </StackPanel>
                                                </StackPanel>
                                                <StackPanel Orientation="Vertical" >
                                                    <TextBlock Text="Cytosol" FontWeight="Bold" Margin="0,-10,0,0" >
                                                    </TextBlock>
                                                    <ListBox x:Name="CellCytosolMolPopsListBox" MinHeight="50" Height="100" MaxHeight="100" Width="150"
                                                             DataContext="{Binding ElementName=CellsListBox, Path=SelectedItem}"
                                                             ItemsSource="{Binding CellMolPops}" 
                                                             ItemTemplate="{Binding Source={StaticResource molListItemTemplate}}"
                                                             SelectedIndex="0"
                                                    />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                        <Button Name="CytosolAddMolButton"  Width="50" Content="Add" />
                                                        <Button Name="CytosolRemoveMolButton" Width="50" Content="Remove" />
                                                    </StackPanel>
                                                </StackPanel>
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Library" FontWeight="Bold" Margin="0,-10,0,0" >
                                                    </TextBlock>
                                                    <ListBox x:Name="lbAllMols" MinHeight="50" MaxHeight="100" Width="150" 
                                                            ItemsSource="{Binding Path=entity_repository.molecules}"                                     
                                                            ItemTemplate="{Binding Source={StaticResource libMolListItemTemplate}}"
                                                            SelectedIndex="0" />
                                                    <!--<TextBlock Text="color" Margin="6,0"
                                                                   Grid.Column="0" Grid.Row="2"  
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                   />
                                                    <editors:ColorEditBox x:Name="solfacColorEditBox"
                                                                      Grid.Column="1" Grid.Row="2"
                                                                      CheckBoxVisibility="Collapsed"
                                                                      SpinnerVisibility="Collapsed"
                                                                      Width="140"
                                                                      HorizontalAlignment="Left" 
                                                                      Format="a r g b"
                                                                      Value="{Binding Path=mpInfo.mp_color}"
                                                                      Margin="0,2"
                                                                      />-->
                                                </StackPanel>
                                                
                                            </StackPanel>
                                        <!--</StackPanel>-->
                                    </Expander>
                                    <!-- Reactions in this cell and their location -->
                                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Cell Reactions"                                              
                                                    x:Name="CellReacExpander"
                                                    Margin="0,5,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                                        <StackPanel>
                                            <!-- Reactions -->
                                            

                                            <StackPanel Orientation="Horizontal">
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Membrane" FontWeight="Bold" Margin="0,-10,0,0" >
                                                    </TextBlock>
                                                    <ListBox x:Name="MembReacListBox" MinHeight="50" Height="100" MaxHeight="100" Width="225"
                                                             DataContext="{Binding ElementName=CellsListBox, Path=SelectedItem}"
                                                             ItemsSource="{Binding reactions}" 
                                                             ItemTemplate="{Binding Source={StaticResource molListItemTemplate}}"
                                                             SelectedIndex="0"
                                                    />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                        <Button Name="MembraneRemoveReacButton" Width="50" Content="Remove" />
                                                    </StackPanel>
                                                </StackPanel>
                                                <StackPanel Orientation="Vertical" >
                                                    <TextBlock Text="Cytosol" FontWeight="Bold" Margin="0,-10,0,0" >
                                                    </TextBlock>
                                                    <ListBox x:Name="CytosolReacPopsListBox" MinHeight="50" Height="100" MaxHeight="100" Width="225"
                                                             DataContext="{Binding ElementName=CellsListBox, Path=SelectedItem}"
                                                             ItemsSource="{Binding reactions}" 
                                                             ItemTemplate="{Binding Source={StaticResource molListItemTemplate}}"
                                                             SelectedIndex="0"
                                                    />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                        <Button Name="CytosolRemoveReacButton" Width="50" Content="Remove" />
                                                    </StackPanel>
                                                </StackPanel>
                                                
                                            </StackPanel>









                                            <!--<ListBox x:Name="CellReacListBox" MinHeight="50" 
                                                    ItemsSource="{Binding Path=CellReactions}" 
                                                    ItemTemplate="{Binding Source={StaticResource reacListItemTemplate}}"
                                                    SelectedIndex="0"
                                            />
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                <Button Name="CellRemoveReacButton" Width="50" Content="Remove" />
                                            </StackPanel>
                                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Details"
                                              x:Name="CellReacDetailsExpander"
                                              Margin="0,-15,0,0" 
                                              Canvas.ZIndex="1"
                                              >
                                                <StackPanel Orientation="Vertical">
                                                    <ContentControl Name="CellReactionDetails"
                                                        Content="{Binding ElementName=CellReacListBox, Path=SelectedItem}" 
                                                        ContentTemplate="{StaticResource reactionDetailsTemplate}" 
                                                        Margin="6"/>
                                                </StackPanel>

                                            </Expander>-->
                                            <Expander ExpandDirection="Down"
                                                  IsExpanded="False"
                                                  Header="Add a reaction"
                                                  x:Name="CellAddReacExpander"
                                                  Margin="0,0,0,0" 
                                                  Canvas.ZIndex="1"
                                                  Expanded="CellAddReacExpander_Expanded"
                                                  >
                                                <StackPanel Orientation="Vertical" Margin="10,0">
                                                    
                                                    <TextBlock Text="Reactions Library" Grid.Column="0" Grid.Row="3"  FontWeight="Bold"  Margin="0,0,6,0" />
                                                    <ListBox x:Name="lbCellAvailableReacs" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                                            ItemsSource="{Binding Path=entity_repository.reactions, Mode=OneWay}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource reactionListItemTemplate}}"
                                                            SelectedIndex="0"
                                                            >
                                                    </ListBox>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                        <Button Name="MembraneAddReacButton"  Width="120" Content="Add to Membrane" Click="MembraneAddReacButton_Click"/>
                                                        <Button Name="CytosolAddReacButton"  Width="120" Content="Add to Cytosol" Click="CytosolAddReacButton_Click"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Expander>


                                        </StackPanel>
                                    </Expander>
                                    <!-- Reaction Complexes in this cell and their location -->
                                    <Expander
                                        Padding="5" 
                                        ExpandDirection="Down"
                                            IsExpanded="False"
                                            Header="Cell Reaction Complexes"                                            
                                            x:Name="CellReacCompExpander"
                                            Margin="0,5,0,0" 
                                            Canvas.ZIndex="1"
                                        BorderThickness="1"
                                        BorderBrush="Black"
                                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                                        <StackPanel>

                                            <StackPanel>
                                                <StackPanel.Resources>
                                                    <DataTemplate x:Key="reacComplexListItemTemplate">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding Path=Name}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </StackPanel.Resources>

                                                <StackPanel.ToolTip>
                                                    <StackPanel Width="200" Orientation="Horizontal">
                                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                        Click Add button to add a reaction complex to the extracellular medium from a list of reactions complexes in the list box below.
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel.ToolTip>
                                                <TextBlock Text="Reaction Complexes" Margin="0,-10,0,0" >
                                                </TextBlock>

                                                <ListBox x:Name="CellReactionComplexListBox" MinHeight="50" 
                                                    ItemsSource="{Binding Path=scenario.ReactionComplexes}" 
                                                    ItemTemplate="{Binding Source={StaticResource reacComplexListItemTemplate}}"
                                                    SelectedIndex="0"     />
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                                <Button Name="CellAddReacCompExpandButton"  Width="50" Content="Add" />
                                                <Button Name="CellRemoveReacCompButton" Width="50" Content="Remove" />
                                            </StackPanel>

                                            <Expander ExpandDirection="Down"
                                                IsExpanded="False"
                                                Header="Add reaction complex"
                                                x:Name="CellAddReacCxExpander"
                                                Margin="0,5,0,0" 
                                                Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                                                <StackPanel Orientation="Vertical" Margin="10,0">
                                                    <StackPanel.Resources>
                                                        <DataTemplate x:Key="reacCxListItemTemplate">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding Path=Name}" />
                                                            </StackPanel>
                                                        </DataTemplate>

                                                        <DataTemplate x:Key="addReacComplexDetailsTemplate">
                                                            <StackPanel>
                                                                <StackPanel Orientation="Vertical">
                                                                    <TextBlock Text="Reactions in selected Complex" Grid.Column="0" Grid.Row="3"  Margin="0,-10,0,0" />
                                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,5,0" AlternationCount="2"                                                        
                                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                                        DisplayMemberPath="TotalReactionString" >
                                                                    </ListBox>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </StackPanel.Resources>
                                                    <TextBlock Text="Reaction Complexes Library"  Margin="0,0,6,0" />
                                                    <ListBox x:Name="lbCellAvailableReacCx" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                                            ItemsSource="{Binding Path=entity_repository.PredefReactionComplexes, Mode=TwoWay}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource reacCxListItemTemplate}}"
                                                            SelectedIndex="0"     >
                                                    </ListBox>
                                                    <StackPanel Orientation="Vertical" HorizontalAlignment="Right" Margin="0,0,6,0" Canvas.ZIndex="10">
                                                        <Button Name="CellAddReacCxButton"  Width="50" Content="Add" Click="CellAddReacCxButton_Click" />
                                                    </StackPanel>
                                                    <ContentControl Name="CellAddReactionComplexDetails"
                                                        Content="{Binding ElementName=lbCellAvailableReacCx, Path=SelectedItem}" 
                                                        ContentTemplate="{StaticResource addReacComplexDetailsTemplate}" 
                                                        Margin="6"/>
                                                </StackPanel>
                                            </Expander>
                                            <Expander ExpandDirection="Down"
                                                IsExpanded="False"
                                                Header="Details"
                                                x:Name="CellReactionComplexDetailsExpander"
                                                Margin="0,5,0,0" 
                                                Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                                                <StackPanel Orientation="Vertical">
                                                    <StackPanel.Resources>
                                                        <DataTemplate x:Key="reactionComplexDetailsTemplate">
                                                            <StackPanel>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="Reaction Complex Name" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="6,0" />
                                                                    <TextBox Margin="0,2" x:Name="txtReacComplexName" Text="{Binding Path=Name, Mode=OneWay}" IsReadOnly="True" />
                                                                </StackPanel>
                                                                <StackPanel Orientation="Vertical">
                                                                    <TextBlock Text="Reactions" Grid.Column="0" Grid.Row="3"  Margin="5,0,0,0" />
                                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="5,0,6,0" AlternationCount="2"                                                        
                                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                                        DisplayMemberPath="TotalReactionString" >
                                                                    </ListBox>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </StackPanel.Resources>
                                                    <ContentControl Name="CellReactionComplexDetails"
                                                        Content="{Binding ElementName=CellReactionComplexListBox, Path=SelectedItem}" 
                                                        ContentTemplate="{StaticResource reactionComplexDetailsTemplate}" 
                                                        Margin="6"/>
                                                </StackPanel>
                                            </Expander>
                                        </StackPanel>
                                    </Expander>

                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </Expander>
                    <!-- REACTION COMPLEXES -->
                    <Expander
                        Padding="5" 
                        ExpandDirection="Down"
                        IsExpanded="False"
                        Header="Reaction Complexes"                           
                        x:Name="ReacComplexExpander"
                        Margin="0,4,0,0" 
                        Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <!-- REACTION COMPLEXES -->
                        <Expander.Resources>
                            <Style  TargetType="{x:Type ListBoxItem}">
                                <Style.Triggers>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                                        <Setter Property="Background" Value="White"></Setter>
                                    </Trigger>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="Beige"></Setter>
                                        <Setter Property="BorderBrush" Value="Black" />
                                        <Setter Property="BorderThickness" Value="1" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Expander.Resources>
                        <StackPanel>
                            <StackPanel.Resources>
                                <DataTemplate x:Key="reacComplexListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" Foreground="Red" />
                                    </StackPanel>
                                </DataTemplate>
                            </StackPanel.Resources>

                            <StackPanel>

                                <TextBlock Text="Reaction Complexes" Grid.Column="0" Grid.Row="0" Margin="0,0,0,0" />
                                <ListBox x:Name="lbComplexes" MinHeight="50"
                                            ItemsSource="{Binding Path=entity_repository.PredefReactionComplexes}"                                                      
                                            ItemTemplate="{Binding Source={StaticResource reacComplexListItemTemplate}}"
                                            SelectedIndex="0">
                                </ListBox>
                            </StackPanel>

                            <StackPanel DataContext="{Binding ElementName=lbComplexes, Path=SelectedItem}" Orientation="Horizontal" HorizontalAlignment="Right"  Canvas.ZIndex="10">
                                <TextBlock Text="Name" HorizontalAlignment="Left" Margin="0,2"/>
                                <TextBox x:Name="txtCxName" Width="150" HorizontalAlignment="Left" Text="{Binding Path=Name}" ></TextBox>
                                <Button x:Name="btnEditComplex" Width="50" Click="btnEditComplex_Click">Edit</Button>
                                <Button x:Name="btnAddComplex" Width="50" Click="btnAddComplex_Click">Add</Button>
                                <Button x:Name="btnRemoveComplex" Width="60" Click="btnRemoveComplex_Click">Remove</Button>
                            </StackPanel>

                            <!-- List of Reactions in selected Reaction Complex -->
                            <StackPanel DataContext="{Binding ElementName=lbComplexes, Path=SelectedItem}" >
                                <TextBlock Text="Reactions" />
                                <ListBox x:Name="lbReactions2" MinHeight="50" AlternationCount="2"
                                    ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                    DisplayMemberPath="TotalReactionString" >
                                </ListBox>
                                <Button x:Name="btnGraphComplex" Grid.Column="4" Grid.Row="3" Grid.ColumnSpan="2" Width="140" HorizontalAlignment="Right" Click="btnGraphComplex_Click">Run Reaction Complex</Button>
                            </StackPanel>
                        </StackPanel>
                    </Expander>
                    <!-- DIFFERENTIATION SCHEMES -->
                    <Expander                                            
                        Padding="5" ExpandDirection="Down"
                        IsExpanded="False"
                        Header="Differentiation Schemes"                                                  
                        x:Name="DiffSchemeExpander"
                        Margin="0,4,0,0" 
                        Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel Orientation="Vertical" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.CanContentScroll="True">
                            <Grid DataContext="{Binding ElementName=lbDiff, Path=SelectedItem}">
                                <Grid.Resources>
                                    <DataTemplate x:Key="diffSchemeListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="geneListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="50" Text="{Binding Path=Name}" />
                                            <CheckBox IsChecked="{Binding Path=Active}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="stateListItemTemplate">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock VerticalAlignment="Top" Text="{Binding Path=Name}" />
                                            <ListBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" 
                                                ItemsSource="{Binding Path=Genes}" DisplayMemberPath="Active" 
                                                ItemTemplate="{Binding Source={StaticResource geneListItemTemplate}}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="cellState2ListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="20" Text="{Binding Path=Name}" />
                                            <TextBlock Width="10" Text="" />
                                            <TextBox Width="50" Text="{Binding Path=MolName}" />
                                            <!--<ComboBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" 
                                                                        ItemsSource="{Binding Path=molecNames}" 
                                                                        />-->
                                        </StackPanel>
                                    </DataTemplate>
                                    <DataTemplate x:Key="cellStateListItemTemplate">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock VerticalAlignment="Top" Text="{Binding Path=Name}" />
                                            <ListBox VerticalContentAlignment="Top" HorizontalContentAlignment="Center" ItemsSource="{Binding Path=CellStates}" DisplayMemberPath="Active" 
                                                                    ItemTemplate="{Binding Source={StaticResource cellState2ListItemTemplate}}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="diffStatesListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="80" Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>

                                    <DataTemplate x:Key="cellStateGridItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="80" Text="{Binding Path=MolName}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </Grid.Resources>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200" />
                                    <ColumnDefinition Width="130" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="120" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>

                                <!-- DIFFERENTIATION SCHEMES -->
                                <!--<TextBlock Text="Differentiation Schemes" Grid.Column="0" Grid.Row="0"  FontWeight="Bold"  Margin="0,10,0,0" />-->
                                <ListBox x:Name="lbDiff" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Height="100" Margin="0,10,0,0" 
                                                            ItemsSource="{Binding Path=ListDiffSchemes}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource diffSchemeListItemTemplate}}"
                                                            SelectedIndex="0" >
                                </ListBox>
                                <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                    <TextBlock Text="Name"  Width="50" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />
                                    <TextBox x:Name="txtDiffName" Text="{Binding Path=Name}"  Width="200" Height="24"  Margin="0,10,0,0"  ></TextBox>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button x:Name="btnEditDiff" Grid.Column="1" Grid.Row="1" Width="40" HorizontalAlignment="Left" >Edit</Button>
                                    <Button x:Name="btnAddDiff" Width="40" HorizontalAlignment="Right" >Add</Button>
                                    <Button x:Name="btnCopyDiff" Width="50" HorizontalAlignment="Left" >Copy</Button>
                                    <Button x:Name="btnRemoveDiff" Width="60" HorizontalAlignment="Right" >Remove</Button>
                                </StackPanel>

                                <TextBlock Text="Epigenetic Map" Grid.Column="0" Grid.Row="2" Width="120" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />

                                <!-- Differentiation Matrix for selected Differentiation Scheme-->
                                <DataGrid Visibility="Hidden" x:Name="dgDiffScheme"  Height="100" Grid.Column="0" Grid.Row="7" Grid.ColumnSpan="2" Margin="0,10,0,0" AlternatingRowBackground="Beige"
                                                                ItemsSource="{Binding Path=CellStates}" DisplayMemberPath="MolName">

                                    <DataGrid.ColumnHeaderStyle>
                                        <Style  TargetType="DataGridColumnHeader" >
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="Background" Value="Beige" />
                                            <Setter Property="BorderBrush" Value="Black" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Setter Property="MinWidth" Value="50" />
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="ContentTemplate" >
                                                <Setter.Value>
                                                    <DataTemplate >
                                                        <StackPanel>
                                                            <TextBlock Text="Header" />
                                                            <!--<TextBlock Text="{Binding}" />-->
                                                            <!--<TextBlock Text="{Binding Path=Name}"/>-->
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>
                                    <DataGrid.RowHeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                        AncestorType={x:Type DataGridRow}}, 
                                                                        Path=Item.Name}"/>
                                        </DataTemplate>
                                    </DataGrid.RowHeaderTemplate>

                                </DataGrid>

                                <StackPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="5">
                                    <!-- This datagrid is the best one so far -->
                                    <DataGrid Margin="0,10,0,0" x:Name="TheGrid" Width="350"
                                                            AutoGenerateColumns="False"
                                                            IsReadOnly="False"
                                                            CanUserAddRows="False" 
                                                                AlternatingRowBackground="Beige"
                                                            >

                                        <DataGrid.RowHeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                    AncestorType={x:Type DataGridRow}}, 
                                                                    Path=Item.Name}"/>
                                            </DataTemplate>
                                        </DataGrid.RowHeaderTemplate>

                                    </DataGrid>
                                    <ListBox Visibility="Hidden"  Height="144" HorizontalAlignment="Left" Margin="0,10,0,0" Name="lbScheme" VerticalAlignment="Top" Width="250" VerticalContentAlignment="Top" 
                                                                ItemsSource="{Binding Path=States}"
                                                                ItemTemplate="{Binding Source={StaticResource stateListItemTemplate}}">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                    </ListBox>
                                </StackPanel>

                                <TextBlock Text="Differentiation Regulators" Grid.Column="0" Grid.Row="5" Width="150" HorizontalAlignment="Left" VerticalAlignment="Center" FontWeight="Bold"  Margin="0,10,0,0" />
                                <StackPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="6" Grid.ColumnSpan="5">

                                    <!-- This CellState datagrid is good -->
                                    <DataGrid Height="144" Width="350" Margin="0,10,0,0" x:Name="CellStateGrid" 
                                                                AutoGenerateColumns="False"
                                                                IsReadOnly="False"
                                                                CanUserAddRows="False" >
                                        <!--SelectedCellsChanged="CellStateGrid_SelectedCellsChanged"-->

                                        <DataGrid.Resources>
                                            <Style x:Name="MyStyle" TargetType="ComboBox">
                                                <Setter Property="IsEnabled" Value="True" />
                                                <Setter Property="Visibility" Value="Visible" />
                                            </Style>
                                        </DataGrid.Resources>
                                        <DataGrid.RowHeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                        AncestorType={x:Type DataGridRow}}, 
                                                                        Path=Item.Name}"/>
                                            </DataTemplate>
                                        </DataGrid.RowHeaderTemplate>

                                    </DataGrid>
                                    <ListBox Visibility="Hidden" Height="144" HorizontalAlignment="Left" Margin="0,10,0,0" Name="lbCellStates" VerticalAlignment="Top" Width="250" VerticalContentAlignment="Top" 
                                                                ItemsSource="{Binding Path=CellStates}"
                                                                ItemTemplate="{Binding Source={StaticResource cellStateListItemTemplate}}">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                    </ListBox>
                                    <!--<Button x:Name="btnDebug1" Height="24" Width="40" HorizontalAlignment="Left" Click="btnDebug1_Click">Debug</Button>-->
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Extracellular Medium -->
        <TabItem Header="Extracellular Medium">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Name="ConfigStackPanel" Orientation="Vertical" Margin="8">
                    <!-- Environment -->
                    <Expander
                                                Padding="5" 
                                                ExpandDirection="Down"
                                                    IsExpanded="False"
                                                    Header="Extracellular Medium Extents"                                              
                                                    x:Name="EnvironmentExpander"
                                                    Margin="0,5,0,0" 
                                                    Canvas.ZIndex="1"
                                                BorderThickness="1"
                                                BorderBrush="Black"
                                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>

                        <TextBlock Text="Extracellular Medium Extents" FontWeight="Bold" Margin="0,-10,0,0" />
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="X" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                            <Slider Name="extent_x_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                Value="{Binding Path=scenario.environment.extent_x}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                            <editors:DoubleEditBox x:Name="ExtentXReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="40" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=extent_x_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                            <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Y" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                            <Slider Name="extent_y_slider"
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center"
                                                    Width="100"
                                                    RenderTransform="1.0,0,0,0.5,0,7"
                                                    Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                    Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                    Value="{Binding Path=scenario.environment.extent_y}" 
                                                    IsSnapToTickEnabled="True" 
                                                    TickFrequency="1" 
                                                    KeyboardNavigation.IsTabStop="False"
                                                    />
                            <editors:DoubleEditBox x:Name="ExtentYReadout" 
                                                                  CheckBoxVisibility="Collapsed" 
                                                                  SpinnerVisibility="Collapsed"
                                                                  HorizontalAlignment="Right"
                                                                  Format="N0"
                                                                  StepValue="1"
                                                                  Width="40" 
                                                                  CenterSlotHorizontalAlignment="Right"
                                                                  Value="{Binding ElementName=extent_y_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                                  />
                            <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Z" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                        <Slider Name="extent_z_slider"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Width="100"
                                                RenderTransform="1.0,0,0,0.5,0,7"
                                                Minimum="{Binding Path=scenario.environment.extent_min}" 
                                                Maximum="{Binding Path=scenario.environment.extent_max}" 
                                                Value="{Binding Path=scenario.environment.extent_z}" 
                                                IsSnapToTickEnabled="True" 
                                                TickFrequency="1" 
                                                KeyboardNavigation.IsTabStop="False"
                                                />
                        <editors:DoubleEditBox x:Name="ExtentZReadout" 
                                                              CheckBoxVisibility="Collapsed" 
                                                              SpinnerVisibility="Collapsed"
                                                              HorizontalAlignment="Right"
                                                              Format="N0"
                                                              StepValue="1"
                                                              Width="40" 
                                                              CenterSlotHorizontalAlignment="Right"
                                                              Value="{Binding ElementName=extent_z_slider, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                              />
                        <TextBlock Text="µm" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="grid step" Margin="6,0"
                                                    Grid.Column="0" Grid.Row="2"  
                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                    TextAlignment="Right"
                                                    Width="60"
                                                    />
                                <Slider Name="sliderGridStep"
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center"
                                                    Width="100"
                                                    RenderTransform="1.0,0,0,0.5,0,7"
                                                    Minimum="{Binding Path=scenario.environment.gridstep_min}" 
                                                    Maximum="{Binding Path=scenario.environment.gridstep_max}" 
                                                    Value="{Binding Path=scenario.environment.gridstep}" 
                                                    IsSnapToTickEnabled="True" 
                                                    TickFrequency="1" 
                                                    KeyboardNavigation.IsTabStop="False"
                                                    ValueChanged="sliderGridStep_ValueChanged"
                                        
                                                    />
                                <editors:DoubleEditBox x:Name="GridStepReadout" 
                                                                  CheckBoxVisibility="Collapsed" 
                                                                  SpinnerVisibility="Collapsed"
                                                                  HorizontalAlignment="Right"
                                                                  Format="N0"
                                                                  StepValue="1"
                                                                  Width="40" 
                                                                  CenterSlotHorizontalAlignment="Right"
                                                                  Value="{Binding ElementName=sliderGridStep, Path=Value, UpdateSourceTrigger=PropertyChanged}"
                                                                  />

                            </StackPanel>

                        </StackPanel>
                        
                    </Expander>
                    <!-- Mol Pops -->
                    <Expander
                            Padding="5" 
                            ExpandDirection="Down"
                                IsExpanded="False"
                                Header="Molecular Populations"                                              
                                x:Name="MolPopsExpander"
                                Margin="0,5,0,0" 
                                Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                            Expanded="EcsMolPopsExpander_Expanded">

                        <StackPanel>
                            <StackPanel.Resources>
                                <DataTemplate x:Key="ecsMolListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" Margin="5,0,0,0"/>
                                    </StackPanel>
                                </DataTemplate>
                                <DataTemplate x:Key="libMolListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Name}" 
                                                   Foreground="{Binding Path=ForegroundColor, Converter={StaticResource textToColorConv}}" 
                                                   Margin="5,0,0,0" />
                                    </StackPanel>
                                </DataTemplate>
                            </StackPanel.Resources>
                            <!-- Molecular Populations -->                            
                            <StackPanel>
                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to create a population of cells from a subset defined below. 
                                    Specify the number of cells, their color and the region (from above) that will contain these cells.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Molecular Populations" FontWeight="Bold" Margin="0,-10,0,0" >
                                </TextBlock>

                            </StackPanel>
                            <ListBox x:Name="lbEcsMolPops" MinHeight="50"
                                    ItemsSource="{Binding Path=scenario.environment.ecs.molpops}" 
                                         ItemTemplate="{Binding Source={StaticResource ecsMolListItemTemplate}}"
                                    SelectedIndex="-1"
                            />

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddEcmMolButton"  Width="50" Content="Add" Click="AddEcmMolButton_Click"/>
                                <Button Name="RemoveEcmMolButton" Width="50" Content="Remove" Click="RemoveEcmMolButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Details"
                                              x:Name="MolDetailsExpander"
                                              Margin="0,-15,0,0" 
                                              Canvas.ZIndex="1"
                                              >

                                <StackPanel Orientation="Vertical">
                                    <ContentControl Name="MolPopDetails"
                                                Content="{Binding ElementName=lbEcsMolPops, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource MolPopDetailsTemplate}" 
                                                Margin="6"/>
                                    <Grid Margin="6,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>

                                        <!---->
                                <TextBlock Text="Molecule" Margin="6,0" 
                                   Grid.Column="0" Grid.Row="0" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                <ComboBox x:Name="molecule_combo_box"
                                        Grid.Column="1" Grid.Row="0" Margin="0,2"
                                        MinWidth="80"
                                        ItemsSource="{Binding entity_repository.molecules}" 
                                          DisplayMemberPath="Name"
                                        SelectedValue="{Binding ElementName=lbEcsMolPops, Path=SelectedItem.molecule_guid_ref, 
                                                                Converter={StaticResource MolGUIDtoMolNameConv}, 
                                                                ConverterParameter={StaticResource moleculesListView}}"
                                        />
                                <!---->
                                        <!--SelectedValue="{Binding ElementName=lbEcsMolPops, Path=SelectedItem.molecule_guid_ref, 
                                                                Converter={StaticResource MolGUIDtoMolNameConv}, 
                                                                ConverterParameter={StaticResource moleculesListView}}"-->
                                        <!--SelectedValue="{Binding ElementName=lbEcsMolPops, Path=SelectedItem.molecule_guid_ref,  Mode=TwoWay}"-->
                                        <!--SelectedValue="{Binding Path=Molecule.Name, Mode=TwoWay}"-->

                                        <TextBlock Text="dist" Margin="6,0" 
                                               Grid.Column="0" Grid.Row="1" 
                                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1" Grid.Row="1"
                                                Name="MolPopDistributionTypeComboBox"
                                                ItemsSource="{Binding Source={StaticResource molpopDistributionTypes}}"
                                                ItemTemplate="{Binding Source={StaticResource molpopDistributionTypeTemplate}}"
                                                SelectedValue="{Binding Path=mp_distribution_type, Mode=OneWay}"
                                                SelectionChanged="MolPopDistributionComboBox_SelectionChanged"
                                                MinWidth="120"
                                                />
                                    </Grid>
                                    <ContentControl Name="SolfacDistributionDetails"
                                                Content="{Binding ElementName=lbEcsMolPops, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource molpopDistributionDetailsTemplate}" 
                                                Margin="6,2"/>

                                </StackPanel>

                            </Expander>
                        </StackPanel>
                    </Expander>
                    <!-- Reactions -->
                    <Expander
                        Padding="5" 
                        ExpandDirection="Down"
                            IsExpanded="False"
                            Header="Reactions"                                              
                            x:Name="ReacExpander"
                            Margin="0,5,0,0" 
                            Canvas.ZIndex="1"
                            Expanded="ECMReacExpander_Expanded"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>
                            <StackPanel.Resources>
                                <DataTemplate x:Key="ecmReactionListItemTemplate">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}" /> 
                                        <TextBlock Text="    " />
                                        <TextBlock Text="Rate: " />
                                        <!--<TextBlock Text="{Binding Path=rate_const}" />-->
                                    </StackPanel>
                                </DataTemplate>
                            </StackPanel.Resources>
                            <!-- Reactions -->
                            <StackPanel>
                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                Click Add button to add a reaction to the extracellular medium from a list of reactions in the list box below.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Reactions" FontWeight="Bold" Margin="0,-10,0,0" >
                                </TextBlock>

                            </StackPanel>
                            <ListBox x:Name="lbEcsReactions" MinHeight="50" 
                                    ItemsSource="{Binding Path=environment.ecs.reactions_guid_ref, 
                                    Converter={StaticResource ReacGUIDtoReacStringConv}, 
                                    ConverterParameter={StaticResource reactionsListView},
                                    Mode=TwoWay}"                                                      
                                    SelectedIndex="0"
                            />

                            <!--ItemTemplate="{Binding Source={StaticResource ecmReactionListItemTemplate}}"-->
                            
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="RemoveEcmReacButton" Width="50" Content="Remove" Click="RemoveEcmReacButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Details"
                                              x:Name="ReacDetailsExpander"
                                              Margin="0,-15,0,0" 
                                              Canvas.ZIndex="1"
                                              >

                                <StackPanel Orientation="Vertical">


                                    <ContentControl Name="ReactionDetails"
                                                Content="{Binding ElementName=lbEcsReactions, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource reactionDetailsTemplate}" 
                                                Margin="6"/>

                                    

                                </StackPanel>

                            </Expander>
                            <Expander ExpandDirection="Down"
                                              IsExpanded="False"
                                              Header="Add a reaction"
                                              x:Name="AddReacExpander"
                                              Margin="0,0,0,0" 
                                              Canvas.ZIndex="1"
                                              >
                                <StackPanel Orientation="Vertical" Margin="10,0">
                                    <!--<StackPanel.Resources>
                                        <DataTemplate x:Key="reactionListItemTemplate">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Path=TotalReactionString}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>-->
                                    <TextBlock Text="Reactions Library" Grid.Column="0" Grid.Row="3"  FontWeight="Bold"  Margin="0,0,6,0" />
                                    <ListBox x:Name="lbAvailableReacs" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                                            ItemsSource="{Binding Path=entity_repository.reactions, Mode=TwoWay}"                                                      
                                                            ItemTemplate="{Binding Source={StaticResource reactionListItemTemplate}}"
                                                            SelectedIndex="0"
                                             MinHeight="50" MaxHeight="150"
                                                            >
                                    </ListBox>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                        <Button Name="AddEcmReacButton"  Width="50" Content="Add" Click="AddEcmReacButton_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>


                        </StackPanel>
                    </Expander>
                    <!-- Reaction Complexes -->
                    <Expander
                        Padding="5" 
                        ExpandDirection="Down"
                            IsExpanded="False"
                            Header="Reaction Complexes"                                            
                            x:Name="ReacCompExpander"
                            Margin="0,5,0,0" 
                            Canvas.ZIndex="1"
                        BorderThickness="1"
                        BorderBrush="Black"
                        Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >

                        <StackPanel>
                            
                            <StackPanel>
                                <StackPanel.Resources>
                                    <DataTemplate x:Key="reacComplexListItemTemplate">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Path=Name}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </StackPanel.Resources>

                                <StackPanel.ToolTip>
                                    <StackPanel Width="200" Orientation="Horizontal">
                                        <TextBlock TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="5" Width="200">
                                                        Click Add button to add a reaction complex to the extracellular medium from a list of reactions complexes in the list box below.
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel.ToolTip>
                                <TextBlock Text="Reaction Complexes" Margin="0,-10,0,0" >
                                </TextBlock>
                        
                                <ListBox x:Name="ReactionComplexListBox" MinHeight="50" 
                                    ItemsSource="{Binding Path=scenario.ReactionComplexes}" 
                                    ItemTemplate="{Binding Source={StaticResource reacComplexListItemTemplate}}"
                                    SelectedIndex="0"
                                 />

                            </StackPanel>
                    
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddReacCompExpandButton"  Width="50" Content="Add" Click="AddReacCompExpandButton_Click"/>
                                <Button Name="RemoveReacCompButton" Width="50" Content="Remove" Click="RemoveReacCompButton_Click" />
                            </StackPanel>

                            
                            
                            
                            <Expander ExpandDirection="Down"
                                IsExpanded="False"
                                Header="Add reaction complex"
                                x:Name="AddReacCxExpander"
                                Margin="0,5,0,0" 
                                Canvas.ZIndex="1"
                                BorderThickness="1"
                                BorderBrush="Black"
                                Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >
                                              
                                <StackPanel Orientation="Vertical" Margin="10,0">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="reacCxListItemTemplate">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Path=Name}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    
                                        <DataTemplate x:Key="addReacComplexDetailsTemplate">
                                            <StackPanel>                                                
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Reactions in selected Complex" Grid.Column="0" Grid.Row="3"  Margin="0,-10,0,0" />
                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,5,0" AlternationCount="2"                                                        
                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                        DisplayMemberPath="TotalReactionString" >
                                                    </ListBox>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>
                                    
                                    <TextBlock Text="Reaction Complexes Library"  Margin="0,0,6,0" />
                                    <ListBox x:Name="lbAvailableReacCx" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,6,0" AlternationCount="2"                                                        
                                        ItemsSource="{Binding Path=entity_repository.PredefReactionComplexes, Mode=TwoWay}"                                                      
                                        ItemTemplate="{Binding Source={StaticResource reacCxListItemTemplate}}"
                                        SelectedIndex="0"
                                        >
                                    </ListBox>
                                    <StackPanel Orientation="Vertical" HorizontalAlignment="Right" Margin="0,0,6,0" Canvas.ZIndex="10">
                                        <Button Name="AddReacCxButton"  Width="50" Content="Add" Click="AddReacCompButton_Click"/>
                                    </StackPanel>

                                    <ContentControl Name="AddReactionComplexDetails"
                                        Content="{Binding ElementName=lbAvailableReacCx, Path=SelectedItem}" 
                                        ContentTemplate="{StaticResource addReacComplexDetailsTemplate}" 
                                        Margin="6"/>
                                
                                </StackPanel>
                            </Expander>

                            <Expander ExpandDirection="Down"
                                    IsExpanded="False"
                                    Header="Details"
                                    x:Name="ReactionComplexDetailsExpander"
                                    Margin="0,5,0,0" 
                                    Canvas.ZIndex="1"
                                    BorderThickness="1"
                                    BorderBrush="Black"
                                    Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}" >                                

                                <StackPanel Orientation="Vertical">
                                    <StackPanel.Resources>
                                        <DataTemplate x:Key="reactionComplexDetailsTemplate">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Reaction Complex Name" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="6,0" />
                                                    <TextBox Margin="0,2" x:Name="txtReacComplexName" Text="{Binding Path=Name, Mode=OneWay}" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Orientation="Vertical">
                                                    <TextBlock Text="Reactions" Grid.Column="0" Grid.Row="3"  Margin="5,0,0,0" />
                                                    <ListBox x:Name="lbReacsInComplex" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Margin="5,0,6,0" AlternationCount="2"                                                        
                                                        ItemsSource="{Binding Path=Reactions, Mode=OneWay}"                                                      
                                                        DisplayMemberPath="TotalReactionString" >
                                                    </ListBox>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </StackPanel.Resources>

                                    <ContentControl Name="ReactionComplexDetails"
                                        Content="{Binding ElementName=ReactionComplexListBox, Path=SelectedItem}" 
                                        ContentTemplate="{StaticResource reactionComplexDetailsTemplate}" 
                                        Margin="6"/>

                                </StackPanel>
                            </Expander>
                            
                        </StackPanel>
                    </Expander>

                    
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- CELL POPULATIONS -->
        <TabItem Header="Cell Populations">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="EntitiesStackPanel" Orientation="Vertical" Margin="8">
                    <!-- CELL POPULATIONS -->
                    <Expander ExpandDirection="Down" Padding="5"
                            IsExpanded="False"
                            Header="Cell Populations"
                            x:Name="CellPopsExpander"
                            Margin="0,4,0,0" 
                            Canvas.ZIndex="1"
                            BorderThickness="1"
                            BorderBrush="Black"
                            Background="{shared:LinearGradientBrush #EEEEEE, #CCCCCC, GradientType=TopLeftToBottomRight}"
                            >

                        <StackPanel>
                            <ListBox x:Name="CellPopsListBox" MinHeight="50" 
                                             ItemsSource="{Binding Path=scenario.cellpopulations}" 
                                             ItemTemplate="{Binding Source={StaticResource cellPopListItemTemplate}}"
                                             SelectedIndex="0"
                                             />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Canvas.ZIndex="10">
                                <Button Name="AddCellPopButton"  Width="50" Content="Add" Click="AddCellButton_Click"/>
                                <Button Name="RemoveCellPopButton" Width="50" Content="Remove" Click="RemoveCellButton_Click" />
                            </StackPanel>
                            <Expander ExpandDirection="Down" Padding="6"
                                    IsExpanded="False"
                                    Header="Cell Population Details"
                                    x:Name="CellPopsDetailsExpander"
                                    Margin="0,-15,0,0" 
                                    Canvas.ZIndex="1"
                                    
                                    >

                                <StackPanel Orientation="Vertical">
                                    <StackPanel Orientation="Horizontal">
                                        <ContentControl Name="CellPopDetails"
                                                Content="{Binding ElementName=CellPopsListBox, Path=SelectedItem}" 
                                                ContentTemplate="{StaticResource cellPopDetailsTemplate}" 
                                                Margin="6,-4"/>
                                    </StackPanel>

                                    
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

    </TabControl>
</docking:ToolWindow>
